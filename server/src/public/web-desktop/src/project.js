require=function e(t,n,i){function a(o,r){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!r&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return a(n||e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({ApiClient:[function(e,t,n){"use strict";function i(e){this.endPoint=e;var t=document.getElementById("GameCanvas"),n=t.getAttribute("gof-access-token")||localStorage.getItem("gof-access-token"),i=t.getAttribute("gof-channel-id")||localStorage.getItem("gof-channel-id");n&&(this.accessToken=n),i&&(this.channelId=i)}function a(e){if(!e)return"";for(var t="",n=Object.keys(e),i=0;i<n.length;++i)i>0&&(t+="&"),t+=n[i]+"="+encodeURIComponent(e[n[i]]);return t.length>0?t:null}function s(e,t,n,i){return r(e,"GET",t,n,i)}function o(e,t,n){var i=r(e,"POST",t,null,n);return i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i}function r(e,t,n,i,s){var o=new XMLHttpRequest,r=a(i),c=e.endPoint+n+(r.length?"?"+r:"");return o.open(t,c,!0),e.accessToken&&o.setRequestHeader("Authorization","Bearer "+e.accessToken),o.onreadystatechange=function(t){if(4==o.readyState){var n=null;try{n=JSON.parse(o.responseText)}catch(e){}200!==o.status&&s?s(n,null,e):s&&s(null,n,e)}},o}cc._RF.push(t,"a5aaaraT9pJs4mh90pQOvW8","ApiClient"),i.prototype.checkAuth=function(e){s(this,"/auth/check",null,e).send(null)},i.prototype.login=function(e,t,n){var i=o(this,"/auth/login",function(e,t,i){t&&(i.accessToken=t.payload.accessToken),n(e,t,i)}),s=a({email:e,password:t});i.send(s)},i.prototype.getItems=function(e,t,n){s(this,"/"+e,t,n).send()},i.prototype.getItem=function(e,t,n){s(this,"/"+e+"/"+encodeURIComponent(t),null,n).send()},i.prototype.getActivity=function(e,t){s(this,"/activities/"+encodeURIComponent(e),null,t).send()},i.prototype.getActivities=function(e,t){s(this,"/activities",e,t).send()},i.prototype.getScenarios=function(e,t){(e?s(this,"/scenarios/"+encodeURIComponent(e),null,t):s(this,"/scenarios",null,t)).send()},i.prototype.getGameData=function(e){if(this.channelId){s(this,"/channel/getgamedata/"+encodeURIComponent(this.channelId),null,e).send()}else cc.error("Missing channel id")},i.prototype.setGameData=function(e,t){if(this.channelId){var n=null;n=o(this,"/channel/setgamedata",t);var i=a({chanId:this.channelId,gameData:e});n.send(i)}else cc.error("Missing channel id")},i.prototype.setScore=function(e,t,n){if(this.channelId){var i=null;i=o(this,"/channel/setscore",n);var s=a({chanId:this.channelId,score:e,details:t});i.send(s)}else cc.error("Missing channel id")},t.exports=i,cc._RF.pop()},{}],Farm:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"a0071wrzthDjJMdvjOEmTUS","Farm"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=(e("Parcel"),function(){function e(t,n){i(this,e),this.name=t,this.totalSurface=void 0===n?0:n,this.surfacePerTile=1,this.parcels=[],this.possibleSpecies=[],this.money=0,this.workTime=0,this.year=0,this.month=0,this.week=0}return a(e,[{key:"addParcel",value:function(e){this.parcels.push(e)}},{key:"findParcelAt",value:function(e){for(var t=0;t<this.parcels.length;t++){var n=this.parcels[t];if(n.hasTile(e))return n}return null}},{key:"findParcelAdjacent",value:function(e){for(var t=0;t<this.parcels.length;t++){var n=this.parcels[t];if(n.isAdjacent(e))return n}return null}},{key:"findParcelUID",value:function(e){if(void 0!==e){var t=this.parcels.find(function(t){return t.uid==e});if(void 0!==t)return t}return null}},{key:"serialize",value:function(){for(var e={parcels:[],money:this.money,workTime:this.workTime},t=0;t<this.parcels.length;t++){var n=this.parcels[t];e.parcels.push(n.serialize())}return e}},{key:"deserialize",value:function(e){this.money=e.money,this.workTime=e.workTime;for(var t=0;t<e.parcels.length;t++){var n=e.parcels[t],i=this.findParcelUID(n.uid);null!=i?i.deserialize(n):cc.error("Can't find parcel UID: "+n.uid)}}}]),e}());n.default=s,t.exports=n.default,cc._RF.pop()},{Parcel:"Parcel"}],GamePhase:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"3ac1bWprMFKCozrFNz9biyB","GamePhase"),Object.defineProperty(n,"__esModule",{value:!0});n.default=function e(){i(this,e),this.uid="assolement",this.startMoney=5e4,this.startMonth=7,this.startWeek=3,this.introTextId=null,this.objctiveTextId=null,this.startYearDiff=0,this.perfectScore=0,this.maxPrevisions=1,this.endCondition="false",this.completionStr="",this.plantExcludes=[],this.parcels=[{uid:"parcel1",history:[{species:"ble",culture:"bio"},{species:"orge",culture:"normal"}]}]},t.exports=n.default,cc._RF.pop()},{}],Game:[function(require,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(module,"37f159UDU9GBpEOdPYC0xWt","Game"),Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_class,_temp,CGamePhase=require("./GamePhase"),CParcelSetup=require("./ParcelSetup"),CFarm=require("./Farm"),CPlant=require("./Plant"),i18n=require("LanguageData"),SharedConsts=require("./common/constants"),ApiClient=require("./ApiClient"),UIDebug=require("./UI/UIDebug"),UIEnv=require("./UI/UIEnv"),CUsableItem=require("./UsableItem"),DEBUG=!1,ConfigDebug={LANGUAGE_DEFAULT:"fr",MAP_ZOOM_MAX:1.7,MAP_ZOOM_MIN:.1},ConfigMaster={LANGUAGE_DEFAULT:"fr",MAP_ZOOM_MAX:1,MAP_ZOOM_MIN:.4},instance=null,criticalError=function(e,t){if(e)if(DEBUG){var n=e.message;t&&(n+="\n"+t),UIEnv.message.show(n,i18n.t("error"),{buttons:"none"})}else UIEnv.message.show(e.message,i18n.t("error"),{buttons:"none"})},CGame=(_temp=_class=function(){function CGame(){if(_classCallCheck(this,CGame),this.state=CGame.State.INVALID,this._currPhase=null,this._startYear=0,this._saving=!1,instance)return instance;(instance=this).isDebug=DEBUG,instance.constants=SharedConsts,instance.config=DEBUG?ConfigDebug:ConfigMaster,i18n.init(instance.config.LANGUAGE_DEFAULT),instance.farm=new CFarm;var e=new Date(Date.now());instance.farm.year=e.getFullYear(),instance.plants=[],instance.usableItems=[]}return _createClass(CGame,[{key:"findPlant",value:function(e){if(e){var t=instance.plants.find(function(t){return t.species==e});if(void 0!==t)return t}return null}},{key:"findUsableItem",value:function(e){return e?instance.usableItems.find(function(t){return t.name==e}):null}},{key:"_pullUsableItems",value:function(e,t,n){t<e.length?instance.api.getItems(e[t],null,function(i,a,s){if(i)n(i);else{if(a&&Array.isArray(a)){UIDebug.log("Pulled "+e[t]+": "+a.length);for(var o=0;o<a.length;o++){var r=a[o],c=instance.findUsableItem(r.name);c?cc.warn("Found duplicate usableItem: "+c.name):(c=new CUsableItem(r))._valid&&instance.usableItems.push(c)}}instance._pullUsableItems(e,t+1,n)}}):n()}},{key:"pullDatabase",value:function(){instance.api?instance.api.getActivities(null,function(e,t,n){if(e)return criticalError(e);if(t&&Array.isArray(t)){UIDebug.log("Pulled activities: "+t.length);for(var i=0;i<t.length;i++){var a=t[i],s=instance.findPlant(a.species);null!=s?s.update(a):(s=new CPlant(a))._valid&&instance.plants.push(s)}instance._pullUsableItems(["tools","equipments","additives"],0,function(e){e?criticalError(e):(instance._processActivities(),instance.state=CGame.State.READY)})}else UIEnv.message.show(i18n.t("error_connection_failed"),i18n.t("error"),{buttons:"none"}),UIDebug.log("Error: Invalid response for getActivities: "+t)}):cc.error("Please setup CGame.api")}},{key:"saveChannel",value:function(e){if(instance.api&&instance.api.channelId)if(instance._saving)e&&e();else if(instance.state>=CGame.State.PHASE_READY&&instance.state<=CGame.State.PHASE_SCORE){instance._saving=!0;var t={};t.date=Date.now(),t.phaseState=instance.state,t.farm=instance.farm.serialize();var n=instance;instance.api.setGameData(JSON.stringify(t),function(t,i,a){n._saving=!1,e&&e(),t&&UIEnv.message.show(t.message,i18n.t("error"))})}}},{key:"openChannel",value:function(){if(instance.api){instance.state=CGame.State.CHANNEL_OPEN;var e=instance;instance.api.getGameData(function(t,n,i){if(t)return criticalError(t);if(!n.payload.phase)return criticalError(new Error("invalid getgamedata result",n.payload));var a=n.payload.phase;if(n.payload.gameData&&0!=Object.keys(n.payload.gameData).length){UIDebug.log("Restoring existing game from channel");var s=n.payload.gameData;try{if("string"==typeof s&&(s=JSON.parse(n.payload.gameData)),!s||!s.farm||!s.phaseState)return criticalError(new Error("Invalid gameData"),n.payload.gameData);e.farm.deserialize(s.farm)}catch(e){return criticalError(new Error("Exception restoring gameData"),e)}e.loadPhase(a,function(t){t?criticalError(t):(e.state=s.phaseState,UIDebug.log("Restoration succeeded - going to state "+e.state),e.state==CGame.State.PHASE_SCORE&&UIEnv.questInfo.onBtValidate())})}else UIDebug.log("Starting phase from channel: "+a),e.loadPhase(a,criticalError)})}else cc.error("Please setup CGame.api")}},{key:"phaseStart",value:function(){instance.state==CGame.State.PHASE_READY?instance.state=CGame.State.PHASE_RUN:cc.error("Invalid state to start a phase: "+Object.keys()[instance.state+1])}},{key:"phaseFinish",value:function(e,t){if(instance.state<=CGame.State.PHASE_SCORE){instance.state=CGame.State.PHASE_SCORE;var n=JSON.stringify(t);instance.saveChannel(function(){instance.api.setScore(e,n,function(e,t,n){instance.state=CGame.State.PHASE_DONE})})}}},{key:"phaseCanFinish",value:function phaseCanFinish(){return!0===eval(instance._currPhase.endCondition)}},{key:"phaseGetCompletionStr",value:function phaseGetCompletionStr(){return eval(instance._currPhase.completionStr)}},{key:"phaseGetIntroText",value:function(){return i18n.t(instance._currPhase.introTextId)}},{key:"phaseGetObjectiveText",value:function(){return i18n.t(instance._currPhase.objectiveTextId)}},{key:"loadPhase",value:function(e,t){instance.state=CGame.State.PHASE_LOAD,instance.api.getScenarios(e,function(n,i){if(n)t(new Error("Error: Failed to get scenario with uid:"+e+"\n"+n.message));else if(i.scenario.start.farm.parcels.length>instance.farm.parcels.length)t(new Error("Error: the scenario "+e+" contains more parcels than the current gfx farm"));else{var a=new CGamePhase;a.uid=e,a.startMoney=i.scenario.start.farm.treasury,a.startMonth=i.scenario.start.date.month,a.startWeek=i.scenario.start.date.week,a.startYearDiff=i.scenario.start.date.yearDiff,a.introTextId=i.scenario.start.introTextId,a.objectiveTextId=i.scenario.start.objectiveTextId,a.perfectScore=i.scenario.start.score,a.endCondition=i.scenario.end.condition,a.completionStr=i.scenario.end.completionStr,a.plantExcludes=i.scenario.start.farm.excludes,a.maxPrevisions="croprotation"===e?1:0,a.parcels=new Array;for(var s=0;s<i.scenario.start.farm.parcels.length;++s){var o=i.scenario.start.farm.parcels[s],r=new CParcelSetup;r.uid=o.uid,r.solution=o.data.solution,r.history=new Array;for(var c=0;c<o.data.rotationHistory.length;++c)r.history.push(o.data.rotationHistory[c]);a.parcels.push(r)}instance.phase=a,t(null)}})}},{key:"createRandomPhase",value:function(){instance.phase=new CGamePhase;for(var e=0;e<instance.farm.parcels.length;e++){var t=instance.farm.parcels[e];t.rotationHistory=[];for(var n=0;n<5;n++){var i=Math.floor(cc.random0To1()*instance.plants.length);i==instance.plants.length&&i--;var a=instance.plants[i],s=SharedConsts.CultureModeEnum.NORMAL;1==(i=Math.floor(3*cc.random0To1()))&&(s=SharedConsts.CultureModeEnum.BIO),2==i&&(s=SharedConsts.CultureModeEnum.REASONED),t.rotationHistory.push({species:a.species,culture:s})}}}},{key:"_processActivities",value:function(){for(var e=0;e<instance.plants.length;e++){var t=instance.plants[e],n=Object.keys(t.itks);if(n&&n.length>0)for(var i=0;i<n.length;i++){var a=t.itks[n[i]];if(a){"hectare"!=a.sizeUnitName&&UIDebug.log("Unsupported ITK size unit: "+a.sizeUnitName),a.unitCosts={money:0,time:0},a.unitResults={money:0};for(var s="["+a.culture.species+" "+a.culture.mode+"] ",o=0;o<a.procedures.length;o++){var r=a.procedures[o];if(r.unitCosts={money:0,time:0},r.workingGroups)for(var c=0;c<r.workingGroups.length;c++){var l=r.workingGroups[c],u=1;if(l.workingTimePerSizeUnit&&(u=Number(l.workingTimePerSizeUnit),r.unitCosts.time+=u),l.tools)for(p=0;p<l.tools.length;p++)(v=instance.findUsableItem(l.tools[p].name))?r.unitCosts.money+=u*v.pricePerUnit:cc.warn(s+"Missing tool datas: "+l.tools[p].name);if(l.doers)for(var p=0;p<l.doers.length;p++)(v=instance.findUsableItem(l.doers[p]))?r.unitCosts.money+=u*v.pricePerUnit:cc.warn(s+"Missing doers datas: "+l.doers[p])}if(r.inputs)for(var h=0;h<r.inputs.length;h++){var d=r.inputs[h];(g=Number(d.quantityPerSizeUnit))||(g=1),(v=instance.findUsableItem(d.name.trim()))?(d.unitPerSizeUnit?v.unit&&v.unit!=d.unitPerSizeUnit&&cc.warn(s+"Units not corresponding: input "+d.name+"="+d.unitPerSizeUnit+" / database="+v.unit):cc.warn(s+"Missing unitPerSizeUnit in itk input: "+d.name),r.unitCosts.money+=v.pricePerUnit*g):((d.name.indexOf("_seed")>0||d.name.indexOf("_grain")>0)&&(r.unitCosts.money+=t.getBuyPrice(a.culture.mode)*g),cc.warn(s+"Missing itk input datas: "+d.name))}if(r.outputs)for(var f=0;f<r.outputs.length;f++){var m=r.outputs[f],g=Number(m.quantityPerSizeUnit);g||(g=1);var v=instance.findUsableItem(m.name);v?((!m.unitPerSizeUnit||"qt"!=m.unitPerSizeUnit&&"t"!=m.unitPerSizeUnit)&&cc.warn(s+"Missing or unsupported unitPerSizeUnit: "+m.unitPerSizeUnit+" in itk output: "+m.name),a.unitResults.money+=v.pricePerUnit*g):(a.unitResults.money+=t.getSellPrice(a.culture.mode)*g,cc.warn(s+"Missing itk output datas: "+m.name))}a.unitCosts.money+=r.unitCosts.money,a.unitCosts.time+=r.unitCosts.time}}}}}},{key:"phase",get:function(){return instance._currPhase},set:function(e){if(void 0!==e&&null!==e){if(null!==instance._currPhase&&instance._currPhase.uid==e.uid)return;if(instance.farm.month=e.startMonth,instance.farm.week=e.startWeek,null===instance._currPhase){instance.farm.money=e.startMoney,instance.farm.plantExcludes=e.plantExcludes;for(var t=0;t<e.parcels.length;t++){var n=e.parcels[t],i=instance.farm.findParcelUID(n.uid);null!=i?(i.rotationHistory=n.history,i.solution=n.solution):cc.error("Could not find parcel uid "+n.uid)}}else instance.farm.year+=e.startYearDiff;instance._currPhase=e,instance.state=CGame.State.PHASE_READY}else instance._currPhase=null,instance.state!=CGame.State.INVALID&&(instance.state=CGame.State.READY)}}]),CGame}(),_class.State={INVALID:-1,READY:0,CHANNEL_OPEN:10,PHASE_LOAD:11,PHASE_READY:12,PHASE_RUN:13,PHASE_SCORE:14,PHASE_DONE:15},_temp);exports.default=CGame,module.exports=exports.default,cc._RF.pop()},{"./ApiClient":"ApiClient","./Farm":"Farm","./GamePhase":"GamePhase","./ParcelSetup":"ParcelSetup","./Plant":"Plant","./UI/UIDebug":"UIDebug","./UI/UIEnv":"UIEnv","./UsableItem":"UsableItem","./common/constants":"constants",LanguageData:"LanguageData"}],LanguageData:[function(e,t,n){"use strict";function i(e){return window.i18n.languages[e]}function a(e){e&&(o?o.replace(e):o=new s({phrases:e,allowMissing:!0}))}cc._RF.push(t,"61de062n4dJ7ZM9/Xdumozn","LanguageData");var s=e("polyglot.min"),o=null;window.i18n||(window.i18n={languages:{},curLang:""}),t.exports={init:function(e){if(!e||e!==window.i18n.curLang){var t=null;e?(t=i(e),window.i18n.curLang=e):t=i(window.i18n.curLang),a(t)}},t:function(e,t){if(o)return o.t(e,t)},inst:o,updateSceneRenderers:function(){for(var e=cc.director.getScene().children,t=[],n=0;n<e.length;++n){var i=e[n].getComponentsInChildren("LocalizedLabel");Array.prototype.push.apply(t,i)}for(var a=0;a<t.length;++a)t[a].updateLabel();for(var s=[],o=0;o<e.length;++o){var r=e[o].getComponentsInChildren("LocalizedSprite");Array.prototype.push.apply(s,r)}for(var c=0;c<s.length;++c)s[c].updateSprite(window.i18n.curLang)}},cc._RF.pop()},{"polyglot.min":"polyglot.min"}],LocalizedLabelExt:[function(e,t,n){"use strict";cc._RF.push(t,"7eb01WD8EJDeZNKJNi9e5fa","LocalizedLabelExt");var i=e("LanguageData");cc.Class({extends:cc.Component,editor:{executeInEditMode:!0,menu:"i18n/LocalizedTextExt"},properties:{dataID:{get:function(){return this._dataID},set:function(e){this._dataID!==e&&(this._dataID=e,this.updateLabel())}},_dataID:"",forceUppercase:{get:function(){return this._forceUppercase},set:function(e){this._forceUppercase!==e&&(this._forceUppercase=e,this.updateLabel())}},_forceUppercase:!1},onLoad:function(){i.inst||i.init(),this.fetchRender()},fetchRender:function(){var e=this.getComponent(cc.Label);if(e||(e=this.getComponent(cc.RichText)),e)return this.label=e,void this.updateLabel()},updateLabel:function(){if(this.label){var e=i.t(this.dataID);e?(this.forceUppercase&&(e=e.toUpperCase()),this.label.string=e):cc.warn("Missing text id: "+this.dataID)}else cc.error("Failed to update localized text!")}}),cc._RF.pop()},{LanguageData:"LanguageData"}],LocalizedLabel:[function(e,t,n){"use strict";cc._RF.push(t,"744dcs4DCdNprNhG0xwq6FK","LocalizedLabel");var i=e("LanguageData");cc.Class({extends:cc.Component,editor:{executeInEditMode:!0,menu:"i18n/LocalizedLabel"},properties:{dataID:{get:function(){return this._dataID},set:function(e){this._dataID!==e&&(this._dataID=e,this.updateLabel())}},_dataID:""},onLoad:function(){i.inst||i.init(),this.fetchRender()},fetchRender:function(){var e=this.getComponent(cc.Label);if(e)return this.label=e,void this.updateLabel()},updateLabel:function(){this.label?i.t(this.dataID)&&(this.label.string=i.t(this.dataID)):cc.error("Failed to update localized label, label component is invalid!")}}),cc._RF.pop()},{LanguageData:"LanguageData"}],LocalizedSprite:[function(e,t,n){"use strict";cc._RF.push(t,"f34ac2GGiVOBbG6XlfvgYP4","LocalizedSprite");var i=e("SpriteFrameSet");cc.Class({extends:cc.Component,editor:{executeInEditMode:!0,inspector:"packages://i18n/inspector/localized-sprite.js",menu:"i18n/LocalizedSprite"},properties:{spriteFrameSet:{default:[],type:i}},onLoad:function(){this.fetchRender()},fetchRender:function(){var e=this.getComponent(cc.Sprite);if(e)return this.sprite=e,void this.updateSprite(window.i18n.curLang)},getSpriteFrameByLang:function(e){for(var t=0;t<this.spriteFrameSet.length;++t)if(this.spriteFrameSet[t].language===e)return this.spriteFrameSet[t].spriteFrame},updateSprite:function(e){if(this.sprite){var t=this.getSpriteFrameByLang(e);!t&&this.spriteFrameSet[0]&&(t=this.spriteFrameSet[0].spriteFrame),this.sprite.spriteFrame=t}else cc.error("Failed to update localized sprite, sprite component is invalid!")}}),cc._RF.pop()},{SpriteFrameSet:"SpriteFrameSet"}],MapCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"e2e73B/wgFOW6TFModC0XXp","MapCtrl");var i=e("./Game"),a=(e("./Farm"),e("./Parcel")),s=e("./UI/UIParcelButton"),o=e("./UI/UIEnv"),r=e("./UI/UIOffice"),c=e("./UI/UIDebug"),l=e("LanguageData"),u=new i,p=cc.Class({extends:cc.Component,editor:{requireComponent:cc.ScrollView,menu:"gof/MapCtrl"},properties:{mapUILayer:{default:null,type:cc.Node,displayName:"UI layer"},startOffset:{default:new cc.Vec2(0,0),displayName:"Scroll starting pos"},mapParcels:{default:[],type:[cc.TiledMap],displayName:"Parcels maps"},mapSprouts:{default:[],type:[cc.TiledMap],displayName:"Sprouts maps"},mapObjects:{default:[],type:[cc.TiledMap],displayName:"Objects maps"},parcelsGID:{default:[],type:[cc.Integer],displayName:"Parcels GID"},parcelButtonPrefab:{default:null,type:cc.Prefab,displayName:"Prefab Parcels button"},debugLabelPrefab:{default:null,type:cc.Prefab}},statics:{instance:null},_mapScrollView:null,_refMap:null,_refLayer:null,_refSize:null,onLoad:function(){null==p.instance?p.instance=this:cc.error("An instance of MapCtrl already exists"),this._mapScrollView=this.getComponent(cc.ScrollView),this._mapStartSize=this._mapScrollView.content.getContentSize(),this.initTouch()},start:function(e){e||(this._mapScrollView.scrollToOffset(this.startOffset),this.findParcels(),u.isDebug&&this.addDebugInfo())},update:function(e){switch(u.state){case i.State.READY:u.isDebug&&!u.api.channelId?u.loadPhase("croprotation",function(e){if(e)return o.message.show(l.t("error_connection_failed")+"\n\n("+e+")",l.t("error"),{buttons:"none"}),void c.log(e);c.log("Local phase started: "+u.phase.uid)}):u.openChannel();break;case i.State.PHASE_READY:o.questIntro.show()}},checkMapBorders:function(){var e=cc.v2(this._mapScrollView.node.width/2,this._mapScrollView.node.height/2);e=this._refMap.node.convertToNodeSpace(e),e=this.pixelToTile(e,!0);var t=this._refMap.getMapSize(),n=0;e.x<-1&&(n=1-e.x,e.x=-1),e.x>=t.width+1&&(n+=e.x-(t.width+1),e.x=t.width+1-1),e.y<-1&&(n+=1-e.y,e.y=-1),e.y>=t.height+1&&(n+=e.y-(t.height+1),e.y=t.height+1-1),n>0&&(e=this.tileToPixel(e),(e=this.pixelToScroll(e)).x-=this._mapScrollView.node.width/2,e.y-=this._mapScrollView.node.height/2,this._mapScrollView.scrollToOffset(e,.1*n))},initTouch:function(){var e=this;if(this.mapParcels&&this.mapParcels.length>0)this._refMap=this.mapParcels[0],this._refLayer=this._refMap.allLayers()[0];else{if(!(this.mapSprouts&&this.mapSprouts.length>0))return void cc.error("At least one parcel or sprout TiledMap is required");this._refMap=this.mapSprouts[0],this._refLayer=this._refMap.allLayers()[0]}var t=this._refMap.getMapSize(),n=this._refMap.getTileSize();this._refSize=cc.v2(t.width*n.width,t.height*n.height),this._mapScrollView._onMouseWheel=function(e,t){var n=.05;e.getScrollY()<0&&(n=-n);var i=this.content.scaleX+n;i<u.config.MAP_ZOOM_MIN&&(i=u.config.MAP_ZOOM_MIN),i>u.config.MAP_ZOOM_MAX&&(i=u.config.MAP_ZOOM_MAX),this.content.scaleX=i,this.content.scaleY=i,this.content.width=p.instance._refSize.x*i,this.content.height=p.instance._refSize.y*i,this._stopPropagationIfTargetIsMe(e),p.instance.checkMapBorders()},this.node.on(cc.Node.EventType.TOUCH_START,function(t){e._scrollLen=0},this.node),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){e._scrollLen+=cc.pLength(t.touch.getDelta())},this.node),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(t){if(e._scrollLen>2)return e._scrollLen=0,void p.instance.checkMapBorders()}),this.node.on(cc.Node.EventType.TOUCH_END,function(t){if(e._scrollLen>2)return e._scrollLen=0,void p.instance.checkMapBorders();var n=t.touch,i=e._refMap.node.convertToNodeSpace(n.getLocation());if(c.touchLog=n.getLocationX()+","+n.getLocationY()+" => "+i,e.mapObjects&&e.mapObjects.length>0)for(a=0;a<e.mapObjects.length;a++)if(e.touchOnMap(e.mapObjects[a],i))return;if(e.mapSprouts&&e.mapSprouts.length>0)for(a=0;a<e.mapSprouts.length;a++)if(e.touchOnMap(e.mapSprouts[a],i))return;if(e.mapParcels&&e.mapParcels.length>0)for(var a=0;a<e.mapParcels.length;a++)if(e.touchOnMap(e.mapParcels[a],i))return},this.node)},touchOnMap:function(e,t){var n=e.allLayers(),i=this.pixelToTile(t);if(null==i)return!1;for(var a=e.getObjectGroups(),s=a.length-1;s>=0;s--)for(var o=a[s].getObjects(),l=0;l<o.length;l++){var p=o[l],h=.7*p.sgNode.width,d=h/2,f=.15*p.sgNode.height,m=.7*p.sgNode.height;if(cc.rect(p.sgNode.x-d,p.sgNode.y+f,h,m).contains(t))return u.isDebug&&c.log("Clicked on object "+p.name),r.instance.show(),!0}for(s=n.length-1;s>=0;s--){var g=n[s],v=g.getTileGIDAt(i);if(0!=v){if(u.isDebug){var _="Clicked on layer "+g.getLayerName()+" tile("+i.x+","+i.y+") GID="+v,y=u.farm.findParcelAt(i);null!=y&&(_+=" Parcel: "+y.name),c.log(_)}return!0}}return!1},pixelToTile:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._refMap.getMapSize(),i=this._refLayer.getMapTileSize().width,a=this._refLayer.getMapTileSize().height,s=this._refLayer.getLayerSize().width,o=this._refLayer.getLayerSize().height,r=1*e.x,c=1*e.y,l=Math.floor(o-c/a+r/i-s/2),u=Math.floor(o-c/a-r/i+s/2);return t||l>=0&&u>=0&&l<n.width&&u<n.height?cc.v2(l,u):null},pixelToScroll:function(e){var t=this._mapScrollView.content.scaleX;return cc.v2(e.x*t,(this._refSize.y-e.y)*t)},tileToPixel:function(e){return this._refLayer.getPositionAt(e)},tileToUI:function(e){var t=this._refMap.getTileSize(),n=this._refLayer.getPositionAt(e);return n.x+=.5*t.width,n.y+=.5*t.height,this.mapToUI(n)},mapToUI:function(e){return cc.v2(e.x-.5*this.mapUILayer.width,e.y-.5*this.mapUILayer.height)},findParcels:function(){if(this.mapParcels&&this.parcelsGID&&this.parcelsGID.length>0)for(var e=0,t=0;t<this.mapParcels.length;t++){for(var n=this.mapParcels[t].getMapSize(),i=0;i<this.mapParcels[t].allLayers().length;i++)for(var o=this.mapParcels[t].allLayers()[i],r=0;r<n.height;r++)for(var c=0;c<n.width;c++)if(this.parcelsGID.includes(o.getTileGIDAt(c,r))){var p=new cc.Vec2(c,r);if(null!=(m=u.farm.findParcelAdjacent(p))&&m.tiledLayer==o)m.addTile(p);else{var h="parcel"+(u.farm.parcels.length+1),d=l.t("parcel")+" "+String(u.farm.parcels.length+1);(m=new a(h,d,o)).addTile(p),u.farm.addParcel(m)}e++}cc.log("TODO: setup the total surface from a metadata in the map?"),u.farm.totalSurface=55,u.farm.surfacePerTile=u.farm.totalSurface/e}if(u.farm.parcels.length>0)for(var f=0;f<u.farm.parcels.length;f++){var m=u.farm.parcels[f];m.surface=Math.ceil(m.surface*u.farm.surfacePerTile*100)/100;var g=cc.instantiate(this.parcelButtonPrefab);g.getComponent(s).parcel=m,g.setParent(this.mapUILayer),g.setPosition(this.tileToUI(m.rect.center))}else cc.error("No parcels found! Please check you filled the mapParcel and parcelGID arrays")},addDebugInfo:function(){if(this.mapObjects)for(var e=0;e<this.mapObjects.length;e++)for(var t=this.mapObjects[e].getObjectGroups(),n=t.length-1;n>=0;n--)for(var i=t[n].getObjects(),a=0;a<i.length;a++){var s=i[a],o=cc.v2(s.sgNode.x,s.sgNode.y),r=cc.instantiate(this.debugLabelPrefab);r.setParent(this.mapUILayer),r.setPosition(this.mapToUI(o)),r.getComponentInChildren(cc.Label).string=s.name+": "+Math.floor(s.sgNode.x)+","+Math.floor(s.sgNode.y)}},__Debug:function(){}});t.exports=p,cc._RF.pop()},{"./Farm":"Farm","./Game":"Game","./Parcel":"Parcel","./UI/UIDebug":"UIDebug","./UI/UIEnv":"UIEnv","./UI/UIOffice":"UIOffice","./UI/UIParcelButton":"UIParcelButton",LanguageData:"LanguageData"}],ParcelSetup:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"4984bnGpblBl65bjVb7vqIW","ParcelSetup"),Object.defineProperty(n,"__esModule",{value:!0});n.default=function e(){i(this,e)},t.exports=n.default,cc._RF.pop()},{}],Parcel:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"65708Jw+k5C1oyCvtOGSAar","Parcel"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=cc.Enum({EMPTY:0,FALLOW:1,PLOWED:2,SEEDS:4,GROWING:5,READY:6}),o=function(){function e(t,n,a){i(this,e),this.uid=t,this.name=void 0===n?"":n,this.tiledLayer=a,this.tiles=[],this.rect=cc.rect(),this.state=s.EMPTY,this.surface=0,this.rotationHistory=[],this.rotationPrevision=[],this.solution=null}return a(e,[{key:"hasTile",value:function(e){for(var t=0;t<this.tiles.length;t++)if(this.tiles[t].x===e.x&&this.tiles[t].y===e.y)return!0;return!1}},{key:"isAdjacent",value:function(e){for(var t=0;t<this.tiles.length;t++){var n=this.tiles[t];if(1==Math.abs(n.x-e.x)&&0==Math.abs(n.y-e.y))return!0;if(1==Math.abs(n.y-e.y)&&0==Math.abs(n.x-e.x))return!0}return!1}},{key:"addTile",value:function(e){this.tiles.push(e),0==this.rect.width&&(this.rect.x=e.x,this.rect.y=e.y,this.rect.width=1,this.rect.height=1),this.rect.x>e.x&&(this.rect.x=e.x),this.rect.xMax<e.x&&(this.rect.width=e.x-this.rect.x),this.rect.y>e.y&&(this.rect.y=e.y),this.rect.yMax<e.y&&(this.rect.height=e.y-this.rect.y),this.surface++}},{key:"serialize",value:function(){return{uid:this.uid,state:this.state,rotationPrevision:this.rotationPrevision}}},{key:"deserialize",value:function(e){e.uid===this.uid?(this.state=e.state,this.rotationPrevision=e.rotationPrevision):cc.error("Invalid parcel json")}}]),e}();n.default=o,t.exports=n.default,cc._RF.pop()},{}],Plant:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"5c449arTcdBdrBCkvQ3zcI7","Plant"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("./common/constants"),o=function(){function e(t){i(this,e),this._valid=!0,this.dbId={},this.buyPrices={},this.sellPrices={},this.itks={},this.tiledGID=[],void 0!==t&&(this.species=t.species,this.update(t)),void 0===this.species&&(this._valid=!1,cc.error("Invalid plant JSon: "+t))}return a(e,[{key:"update",value:function(e){if(void 0!==e.cultureMode&&void 0!==e.pricePerHectare){var t=this._CultureMode(e.cultureMode);this.dbId[t]&&this.dbId[t]!=e._id&&cc.warn("Conflict on plant: "+this.species+" / mode: "+t),this.dbId[t]=e._id,this.buyPrices[t]=Number(e.pricePerHectare),this.sellPrices[t]=20*Number(e.pricePerHectare),this.itks[t]=e.itk}}},{key:"_CultureMode",value:function(e){var t=e;return t!=s.CultureModeEnum.NORMAL&&t!=s.CultureModeEnum.BIO&&t!=s.CultureModeEnum.REASONED&&(cc.error("Invalid culture mode: "+e),t=s.CultureModeEnum.NORMAL),t}},{key:"getUnitCosts",value:function(e){var t=getItk(e);return t?t.unitCosts:null}},{key:"getBuyPrice",value:function(e){return this.buyPrices[this._CultureMode(e)]}},{key:"getSellPrice",value:function(e){return this.sellPrices[this._CultureMode(e)]}},{key:"getItk",value:function(e){return this.itks[this._CultureMode(e)]}},{key:"getOutputs",value:function(e){var t=[],n=this.getItk(e);if(n&&n.procedures)for(var i=0;i<n.procedures.length;i++)n.procedures[i].outputs&&(t=t.concat(n.procedures[i].outputs));return t}},{key:"isFallow",get:function(){return this.species.indexOf("fallow")>=0||"pasture"===this.species}}]),e}();n.default=o,t.exports=n.default,cc._RF.pop()},{"./common/constants":"constants"}],RscPreload:[function(e,t,n){"use strict";cc._RF.push(t,"65250CXe7xM6InnrNr1oCQh","RscPreload");var i=cc.Class({extends:cc.Component,editor:{menu:"gof/RscPreload"},properties:{plantIconsAtlas:{default:null,type:cc.SpriteAtlas},plantDisIconsAtlas:{default:null,type:cc.SpriteAtlas},noteIconsAtlas:{default:null,type:cc.SpriteAtlas}},statics:{instance:null,_defaultPlantIcon:"ico_generique",_plantIconId:{corn:"mais",wheat:"ble",durum_wheat:"ble",soft_wheat:"ble",carrot:"carotte",sunflower:"tournesol",barley:"orge",oat:"avoine",rye:"seigle",buckwheat:"sarrasin",pea:"pois",beetroot:"betterave",field_bean:"feverole",soy:"soja",pasture:"prairie",flower_fallow:"jachere_fleurie",fallow:"jachere"},getPlantIcon:function(e,t){if(null===i.instance)return cc.error("RscPreload not loaded"),null;var n=i._plantIconId[e];void 0===n&&(n=e);var a=null;return(a=t?i.instance.plantDisIconsAtlas.getSpriteFrame("ico_"+n):i.instance.plantIconsAtlas.getSpriteFrame("ico_"+n))||(cc.warn("Icon not found for species: "+e),a=t?i.instance.plantDisIconsAtlas.getSpriteFrame(this._defaultPlantIcon):i.instance.plantIconsAtlas.getSpriteFrame(this._defaultPlantIcon)),a}},onLoad:function(){null!=i.instance&&cc.error("An instance of RscPreload already exists"),i.instance=this}});t.exports=i,cc._RF.pop()},{}],SpriteFrameSet:[function(e,t,n){"use strict";cc._RF.push(t,"97019Q80jpE2Yfz4zbuCZBq","SpriteFrameSet");var i=cc.Class({name:"SpriteFrameSet",properties:{language:"",spriteFrame:cc.SpriteFrame}});t.exports=i,cc._RF.pop()},{}],Startup:[function(e,t,n){"use strict";cc._RF.push(t,"ae2f9bQf21IhJYFeGxAPR6E","Startup");var i=e("LanguageData"),a=e("./ApiClient"),s=new(e("./Game")),o=e("./UI/UIDebug"),r=e("./UI/UIEnv");cc.Class({extends:cc.Component,editor:{menu:"gof/Startup"},properties:{},onLoad:function(){o.log("CC="+cc.ENGINE_VERSION+" Sys="+cc.sys.os+" Browser="+cc.sys.browserType);var e="/api",t="localhost"==location.hostname&&3e3!=location.port;t&&(e="http://gof.shinypix.dev:3000/api"),o.log("API endpoint: "+e);var n=this,s=new a(e);s.checkAuth(function(e,a,c){if(e){if(!t)return r.message.show(i.t("error_auth_missing"),i.t("error"),{onOk:function(){location.pathname="/auth/login"}}),void o.log("Error: you are not logged in!");var l=prompt("email"),u=prompt("password");c.login(l,u,function(e,t,a){e?(r.message.show(i.t("error_connection_failed"),"Login failed!",{onOk:function(){location.reload()}}),o.log("Error: Login failed!"),cc.error("Login failed")):(localStorage.setItem("gof-access-token",t.payload.accessToken),n.whenLoggedIn(s))})}else n.whenLoggedIn(s)})},start:function(){null!=o.instance&&(o.instance.node.active=s.isDebug)},whenLoggedIn:function(e){s.api=e,s.pullDatabase()}}),cc._RF.pop()},{"./ApiClient":"ApiClient","./Game":"Game","./UI/UIDebug":"UIDebug","./UI/UIEnv":"UIEnv",LanguageData:"LanguageData"}],UIBottom:[function(e,t,n){"use strict";cc._RF.push(t,"de0fchZ+G5HMJdsv+K9r07U","UIBottom");var i=e("LanguageData"),a=e("./UIEnv");e("./UIMessage"),cc.Class({extends:cc.Component,editor:{menu:"gof/UIBottom"},properties:{},onLoad:function(){},onBtQuit:function(){a.message.show(i.t("exit_confirmation"),void 0,{buttons:"yes_no",onOk:function(){location.pathname="/dashboard"}})}});cc._RF.pop()},{"./UIEnv":"UIEnv","./UIMessage":"UIMessage",LanguageData:"LanguageData"}],UICheat:[function(e,t,n){"use strict";cc._RF.push(t,"ee4e2PdBRtJFKhTZAymanIB","UICheat");var i=e("../Game"),a=(e("./UIDebug"),e("../common/constants")),s=new i;cc.Class({extends:cc.Component,properties:{bgPopup:{default:null,type:cc.Node}},onLoad:function(){this.bgPopup.active=!1,s.isDebug&&cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},onDestroy:function(){s.isDebug&&cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},onKeyDown:function(e){switch(e.keyCode){case cc.KEY.c:this.bgPopup.active^=!0;break;case cc.KEY.escape:this.onBtClose()}},onBtRandomRotation:function(){if(s.farm.parcels.length>0)for(var e=0;e<s.farm.parcels.length;e++){var t=s.farm.parcels[e];if(0===t.rotationPrevision.length){var n=Math.floor(cc.random0To1()*s.plants.length);n==s.plants.length&&n--;var i=s.plants[n],o=a.CultureModeEnum.NORMAL;1==(n=Math.floor(3*cc.random0To1()))&&(o=a.CultureModeEnum.BIO),2==n&&(o=a.CultureModeEnum.REASONED),t.rotationPrevision.push({species:i.species,culture:o})}}this.onBtClose()},onBtClearRotation:function(){if(s.farm.parcels.length>0)for(var e=0;e<s.farm.parcels.length;e++){var t=s.farm.parcels[e];t.rotationPrevision.length>0&&(t.rotationPrevision=[])}this.onBtClose()},onBtClose:function(){this.bgPopup.active=!1}}),cc._RF.pop()},{"../Game":"Game","../common/constants":"constants","./UIDebug":"UIDebug"}],UIDebug:[function(e,t,n){"use strict";cc._RF.push(t,"18ea2AjTFtAb7SJWmEwfDmn","UIDebug");var i=cc.Class({extends:cc.Component,editor:{menu:"gof/UIDebug"},properties:{debugLabel:{default:null,type:cc.Label},touchLabel:{default:null,type:cc.Label},mapScrollView:{default:null,type:cc.ScrollView}},statics:{instance:null,_log:[],log:function(e){i._log.unshift(e),i._log.length>12&&i._log.pop()},touchLog:""},onLoad:function(){null!=i.instance&&cc.error("UIDebug instance already loaded"),i.instance=this,this.debugLabel.string="",this.touchLabel.string=""},start:function(e){},update:function(e){if(null!=this.debugLabel){this.debugLabel.string="";for(var t=0;t<i._log.length;t++)this.debugLabel.string+=i._log[t]+"\n"}null!=this.touchLabel&&(this.touchLabel.string=i.touchLog,null!=this.mapScrollView&&(this.touchLabel.string+=" scrollOffset="+this.mapScrollView.getScrollOffset(),this.touchLabel.string+=" zoom="+this.mapScrollView.content.scaleX))}});t.exports=i,cc._RF.pop()},{}],UIEnv:[function(e,t,n){"use strict";cc._RF.push(t,"6d70dhzfZNFH7Qp5lDKoDB3","UIEnv");var i={message:null,office:null,parcel:null,speciesSelect:null,speciesInfos:null,questInfo:null,questMenu:null,score:null,score_croprotation:null,questIntro:null};t.exports=i,cc._RF.pop()},{}],UIMessage:[function(e,t,n){"use strict";cc._RF.push(t,"d4cf2XJ/iVOPJMeqHGyaeP+","UIMessage");var i=e("./UIPopupBase"),a=e("./UIEnv"),s=e("LanguageData"),o=cc.Class({extends:i,editor:{menu:"gof/UIMessage"},properties:{bgLock:{default:null,type:cc.Node},lbTitle:{default:null,type:cc.Label},lbMessage:{default:null,type:cc.Label},btOk:{default:null,type:cc.Button},_lbOk:{default:null,type:cc.Label,visible:!1},btYes:{default:null,type:cc.Button},_lbYes:{default:null,type:cc.Label,visible:!1},btNo:{default:null,type:cc.Button},_lbNo:{default:null,type:cc.Label,visible:!1}},statics:{YES_NO:{buttons:"yes_no"},OK_CANCEL:{buttons:"ok_cancel"}},_messagesOptions:null,onLoad:function(){a.message=this,this.initPopup(),this._lbOk=this.btOk.node.getComponentInChildren(cc.Label),this._lbYes=this.btYes.node.getComponentInChildren(cc.Label),this._lbNo=this.btNo.node.getComponentInChildren(cc.Label),this._lbOk.string=s.t("ok").toUpperCase()},show:function(e,t,n){void 0!==t&&null!==t&&""!=t||(t=s.t("message").toUpperCase()),e.split("\n").length>4?(this.lbMessage.fontSize=20,this.lbMessage.lineHeigth=22):(this.lbMessage.fontSize=30,this.lbMessage.lineHeigth=36),this.lbMessage.string=e,this.lbTitle.string=t,this._messagesOptions=void 0!=n?n:null,this.bgLock.active=!0,null!=this._messagesOptions?(this.btOk.node.active=void 0==this._messagesOptions.buttons||"ok"==this._messagesOptions.buttons,this.btYes.node.active="yes_no"==this._messagesOptions.buttons||"ok_cancel"==this._messagesOptions.buttons,this.btNo.node.active=this.btYes.node.active,this._lbYes.string="yes_no"==this._messagesOptions.buttons?s.t("yes").toUpperCase():s.t("ok").toUpperCase(),this._lbNo.string="yes_no"==this._messagesOptions.buttons?s.t("no").toUpperCase():s.t("cancel").toUpperCase()):(this.btOk.node.active=!0,this.btYes.node.active=!1,this.btNo.node.active=!1),this.showPopup()},hide:function(){this.bgLock.active=!1,this.hidePopup()},onBtOk:function(){void 0!==this._messagesOptions.onOk&&this._messagesOptions.onOk(this._messagesOptions.self),this.hide()},onBtYes:function(){void 0!==this._messagesOptions.onOk&&this._messagesOptions.onOk(this._messagesOptions.self),this.hide()},onBtNo:function(){void 0!==this._messagesOptions.onCancel&&this._messagesOptions.onCancel(this._messagesOptions.self),this.hide()}});t.exports=o,cc._RF.pop()},{"./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UIOffice:[function(e,t,n){"use strict";cc._RF.push(t,"6a190mC+6ZOA5vlgY1st6XK","UIOffice");var i=e("./UIPopupBase"),a=e("../Game"),s=e("./UIEnv"),o=e("LanguageData"),r=cc.Class({extends:i,editor:{menu:"gof/UIOffice"},properties:{farmName:{default:null,type:cc.Label},totalSurface:{default:null,type:cc.Label},nbParcels:{default:null,type:cc.Label}},statics:{instance:null},onLoad:function(){r.instance=this,s.office=this,this.initPopup()},show:function(){s.parcel.hide(),s.speciesSelect.hide(),this.showPopup()},onShow:function(){var e=new a,t=e.farm.name;void 0===t&&(t=o.t("farm_default_name").toUpperCase()),this.farmName.string=t,this.totalSurface.string=o.t("surface_hectare",{val:e.farm.totalSurface}),this.nbParcels.string=e.farm.parcels.length.toString()},onBtClose:function(){this.hide()}});cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UIOutputInfoItem:[function(e,t,n){"use strict";cc._RF.push(t,"025cdYdq1ZFiISVot7vqD8s","UIOutputInfoItem");var i=e("LanguageData"),a=cc.Class({extends:cc.Component,editor:{menu:"gof/UIOutputInfoItem"},properties:{Name:{default:null,type:cc.Label},UnitQuantity:{default:null,type:cc.Label},ParcelQuantity:{default:null,type:cc.Label}},onLoad:function(){},init:function(e,t){this.Name.string=i.t("output_"+t.name).toUpperCase();var n=Number(t.quantityPerSizeUnit),a=n*e.surface,s="quantity_quintal";"t"==t.unitPerSizeUnit&&(s="quantity_ton"),this.UnitQuantity.string=i.t(s,{val:n.toLocaleString(void 0,{maximumFractionDigits:2})}),this.ParcelQuantity.string=i.t(s,{val:a.toLocaleString(void 0,{maximumFractionDigits:2})})}});t.exports=a,cc._RF.pop()},{LanguageData:"LanguageData"}],UIParcelButton:[function(e,t,n){"use strict";cc._RF.push(t,"1eeb4QRRqVC67SdkLrVyELP","UIParcelButton");var i=e("../Parcel"),a=e("./UIParcel"),s=e("../RscPreload");cc.Class({extends:cc.Component,editor:{menu:"gof/UIParcelButton"},properties:{parcelName:{default:null,type:cc.Label},parcelSpecies:{default:null,type:cc.Sprite},parcel:{visible:!1,get:function(){return this._parcel},set:function(e){this._parcel=e,null!=this._parcel&&null!=this.parcelName&&(this.parcelName.string=this._parcel.name)},type:i}},_parcel:null,_species:null,onLoad:function(){this.parcelSpecies.node.active=!1},update:function(e){if(null!=this._parcel){var t=null;this._parcel.rotationPrevision.length>0&&(t=this._parcel.rotationPrevision[0].species),t!=this._species&&(null!=t?(this.parcelSpecies.node.active=!0,this.parcelSpecies.spriteFrame=s.getPlantIcon(t)):this.parcelSpecies.node.active=!1,this._species=t)}},onButtonClick:function(){a.instance.parcel=this.parcel,a.instance.show()}}),cc._RF.pop()},{"../Parcel":"Parcel","../RscPreload":"RscPreload","./UIParcel":"UIParcel"}],UIParcelHistoryItem:[function(e,t,n){"use strict";cc._RF.push(t,"e26d4zHk5xHfoZ0d5p3J3O6","UIParcelHistoryItem");var i=e("LanguageData"),a=e("../Game"),s=e("../Parcel"),o=e("../Plant"),r=e("../RscPreload"),c=e("./UIEnv"),l=(e("../common/constants"),new a),u=cc.Class({extends:cc.Component,editor:{menu:"gof/UIParcelHistoryItem"},properties:{iconSpecies:{default:null,type:cc.Sprite},lbSpecies:{default:null,type:cc.Label},lbCulture:{default:null,type:cc.Label},lbYear:{default:null,type:cc.Label},btAdd:{default:null,type:cc.Button},btEdit:{default:null,type:cc.Button},btInfo:{default:null,type:cc.Button},parcel:{default:null,visible:!1,type:s},year:{default:0,visible:!1},plant:{default:null,visible:!1,type:o},cultureMode:{default:null,visible:!1}},onLoad:function(){},initCulture:function(e,t,n,a){if(this.parcel=e,this.year=t,this.plant=null,this.cultureMode=null,t){var s;s=t<0?t.toString():"+"+t.toString(),this.lbYear.string=s}else this.lbYear.string="";void 0===n||null===n?(this.lbSpecies.string=i.t("new").toUpperCase(),this.lbCulture.string="",this.iconSpecies.node.active=!1,this.btAdd.node.active=!0,this.btEdit.node.active=!1,this.btInfo.node.active=!1):n.species.indexOf("fallow")>=0||"pasture"===n.species?(this.lbSpecies.string=i.t("plant_"+n.species).toUpperCase(),this.lbCulture.string="",this.iconSpecies.node.active=!0,this.iconSpecies.spriteFrame=r.getPlantIcon(n.species),this.btAdd.node.active=!1,this.btEdit.node.active=a,this.btInfo.node.active=!1):(this.cultureMode=n.culture,this.plant=l.findPlant(n.species),this.lbSpecies.string=i.t("plant_"+n.species).toUpperCase(),void 0!==n.culture?this.lbCulture.string=i.t("culture_"+n.culture).toUpperCase():this.lbCulture.string=i.t("culture_normal").toUpperCase(),this.iconSpecies.node.active=!0,this.iconSpecies.spriteFrame=r.getPlantIcon(n.species),this.btAdd.node.active=!1,this.btEdit.node.active=a,this.plant&&a?(this.btInfo.node.active=!0,this.btInfo.interactable=void 0!==this.plant.getItk(this.cultureMode)):this.btInfo.node.active=!1)},onBtAdd:function(){c.speciesSelect.show(this.parcel,this.year)},onBtInfo:function(){c.speciesInfos.show(this.parcel,this.plant,this.cultureMode)}});t.exports=u,cc._RF.pop()},{"../Game":"Game","../Parcel":"Parcel","../Plant":"Plant","../RscPreload":"RscPreload","../common/constants":"constants","./UIEnv":"UIEnv",LanguageData:"LanguageData"}],UIParcel:[function(e,t,n){"use strict";cc._RF.push(t,"5ed45J19xFADpo251R2d6oz","UIParcel");var i=e("./UIPopupBase"),a=e("../Parcel"),s=e("./UIParcelHistoryItem"),o=e("../Game"),r=e("./UIEnv"),c=e("LanguageData"),l=new o,u=cc.Class({extends:i,editor:{menu:"gof/UIParcel"},properties:{parcelName:{default:null,type:cc.Label},parcelGroundType:{default:null,type:cc.Label},parcelSurface:{default:null,type:cc.Label},historyScrollView:{default:null,type:cc.ScrollView},previsionScrollView:{default:null,type:cc.ScrollView},plantPrefab:{default:null,type:cc.Prefab},parcel:{visible:!1,get:function(){return this._parcel},set:function(e){this._parcel=e,null!=this._parcel&&this.parcelName,this._hidden||this.onShow()},type:a}},statics:{instance:null},_parcel:null,onLoad:function(){u.instance=this,this.initPopup(),r.parcel=this},show:function(){r.office.hide(),this.showPopup()},onShow:function(){var e=this.historyScrollView.content;if(e.removeAllChildren(!0),this.previsionScrollView.content.removeAllChildren(!0),null!=this._parcel){this.parcelName.string=this._parcel.name,this.parcelGroundType.string=c.t("terrain_type_clay").toUpperCase(),this.parcelSurface.string=c.t("surface_hectare",{val:this._parcel.surface.toString()});for(var t=this._parcel.rotationHistory.length-1;t>=0;t--){var n=cc.instantiate(this.plantPrefab);n.setParent(e),n.getComponent(s).initCulture(this._parcel,-(t+1),this._parcel.rotationHistory[t],!1)}this.updateRotationPrevisions(),this.historyScrollView.scrollToRight(),this.previsionScrollView.scrollToLeft()}},updateRotationPrevisions:function(){var e=this.previsionScrollView.content;e.removeAllChildren(!0);for(var t=0;t<this._parcel.rotationPrevision.length;t++){var n=cc.instantiate(this.plantPrefab);n.setParent(e),n.getComponent(s).initCulture(this._parcel,t,this._parcel.rotationPrevision[t],!0)}this.addEmptyPrevision()},addEmptyPrevision:function(){if(null!=l.phase&&this._parcel.rotationPrevision.length<l.phase.maxPrevisions){var e=cc.instantiate(this.plantPrefab);e.setParent(this.previsionScrollView.content),e.getComponent(s).initCulture(this._parcel,this._parcel.rotationPrevision.length)}},onBtClose:function(){this.hide()}});t.exports=u,cc._RF.pop()},{"../Game":"Game","../Parcel":"Parcel","./UIEnv":"UIEnv","./UIParcelHistoryItem":"UIParcelHistoryItem","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UIPopupBase:[function(e,t,n){"use strict";cc._RF.push(t,"26b02/CIaZOIqLKQKleyE5X","UIPopupBase");var i=cc.Enum({LEFT:0,RIGHT:1,TOP:2,BOTTOM:3,NONE:4});cc.Class({extends:cc.Component,properties:{Popup:{default:null,type:cc.Node},From:{default:i.LEFT,type:i},isShown:{visible:!1,get:function(){return!this._hidden}}},_hidden:!1,initPopup:function(){null==this.Popup&&(this.Popup=this.node),this._hidden=!1,this._defaultX=this.Popup.x,this._defaultY=this.Popup.y,this._size=this.Popup.getContentSize(),this.hide(!0)},showPopup:function(){this._hidden&&(this.Popup.stopAllActions(),this.Popup.active||(this.Popup.active=!0),this.From!=i.NONE&&this.Popup.runAction(cc.moveTo(.2,cc.p(this._defaultX,this._defaultY))),this._hidden=!1,void 0!==this.onShow&&this.onShow())},hidePopup:function(e){if(!this._hidden){if(this.Popup.stopAllActions(),this.From!=i.NONE){var t=cc.Canvas.instance.node.width,n=cc.Canvas.instance.node.height,a=new cc.Vec2(this._defaultX,this._defaultY);switch(this.From){case i.LEFT:a.x=-t;break;case i.RIGHT:a.x=t;break;case i.TOP:a.y=n;break;case i.BOTTOM:a.y=-n;break;default:cc.error("Invalid from value: "+this.From),a.x=-t}e?(this.Popup.x=a.x,this.Popup.y=a.y):this.Popup.runAction(cc.moveTo(.2,a))}else this.Popup.active=!1;this._hidden=!0,void 0!==this.onHide&&this.onHide()}},show:function(){this.showPopup()},hide:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.hidePopup(e)}});cc._RF.pop()},{}],UIQuestInfo:[function(e,t,n){"use strict";cc._RF.push(t,"fe209aGUCRMrqhIU/Rt+APS","UIQuestInfo");var i=e("./UIPopupBase"),a=e("./UIEnv"),s=new(e("../Game")),o=cc.Class({extends:i,editor:{menu:"gof/UIQuestInfo"},properties:{lbDescription:{default:null,type:cc.Label},lbCompletion:{default:null,type:cc.Label},btValidate:{default:null,type:cc.Button}},statics:{instance:null},onLoad:function(){o.instance=this,a.questInfo=this,this.initPopup()},onShow:function(){null!=s.phase&&(this.lbDescription.string=s.phaseGetObjectiveText(),this.lbCompletion.string=s.phaseGetCompletionStr(),this.btValidate.interactable=s.phaseCanFinish())},onBtValidate:function(){if(s.phaseCanFinish()){for(var e=0,t=s.phase.perfectScore/s.farm.parcels.length,n=[],i=0;i<s.farm.parcels.length;++i){var o=s.farm.parcels[i],r=o.solution,c=o.rotationPrevision[0],l={parcelName:o.name,note:4,choice:c};r.perfects.indexOf(c.species)>-1?(l.note=1,e+=t):r.acceptables.indexOf(c.species)>-1?(l.note=2,e+=.8*t):r.bads.indexOf(c.species)>-1&&(l.note=3,e-=.4*t),n.push(l)}var u=(e=Math.round(e))/s.phase.perfectScore;u>1&&(u=1),a.score_croprotation.setResults(n),a.score_croprotation.setScoreText(Math.round(20*u)+" / 20"),a.score_croprotation.show(),s.phaseFinish(u,n)}},onBtClose:function(){this.hide()}});t.exports=o,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase"}],UIQuestIntro:[function(e,t,n){"use strict";cc._RF.push(t,"a2ec7ttv5JG+pgS8fICxmUc","UIQuestIntro");e("./UIPopupBase");var i=e("./UIEnv"),a=new(e("../Game")),s=cc.Class({extends:cc.Component,editor:{menu:"gof/UIQuestIntro"},properties:{bgLock:{default:null,type:cc.Node},popup:{default:null,type:cc.Node},lbDescription:{default:null,type:cc.Label},_hidden:{default:!0,visible:!1}},onLoad:function(){i.questIntro=this,this.bgLock.active=!1,this._from=this.From,this._hidden=!0,this._defaultX=this.popup.x,this._defaultY=this.popup.y,this.popup.active=!1},show:function(){null!=a.phase&&(this.lbDescription.string=a.phaseGetIntroText()),this.bgLock.active=!0,this.popup.active=!0,this.popup.x=this._defaultX,this.popup.y=this._defaultY,this._hidden=!1},hide:function(){this.bgLock.active=!1,this.hidePopup()},hidePopup:function(e){if(!this._hidden){this.popup.stopAllActions();cc.Canvas.instance.node.width;var t=cc.Canvas.instance.node.height,n=new cc.Vec2(this._defaultX,this._defaultY);n.y=t,e?(this.popup.x=n.x,this.popup.y=n.y):this.popup.runAction(cc.moveTo(.2,n)),this._hidden=!0}},onBtStart:function(){a.phaseStart(),this.hide()}});t.exports=s,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase"}],UIQuestMenu:[function(e,t,n){"use strict";cc._RF.push(t,"7d7c3/wn7ZCuLYYti4yjtS7","UIQuestMenu");var i=e("../Game"),a=e("./UIEnv"),s=new i,o=cc.Class({extends:cc.Component,editor:{menu:"gof/UIQuestMenu"},properties:{btOpen:{default:null,type:cc.Button},highlight:{default:null,type:cc.Node},_hlAnim:{default:null,type:cc.Animation,visible:!1},fxParticles:{default:null,type:cc.ParticleSystem},_isAnimated:{default:!1,visible:!1},progressBar:{default:null,type:cc.ProgressBar},progressLabel:{default:null,type:cc.Label},_completion:{default:""}},onLoad:function(){a.questMenu=this,this._hlAnim=this.highlight.getComponent(cc.Animation),this.highlight.active=!1,this.fxParticles.stopSystem(),this._isAnimated=!1,this.btOpen.interactable=!1,this.progressBar.progress=0,this.progressLabel.string="0%"},update:function(e){if(!(s.state<i.State.PHASE_RUN)){this.btOpen.interactable=s.state<i.State.PHASE_SCORE&&null!=a.questInfo&&!a.questInfo.isShown;var t=this.btOpen.interactable&&s.phaseCanFinish();t!=this._isAnimated&&(t?(this.highlight.active=!0,this._hlAnim.play(),this.fxParticles.resetSystem()):(this._hlAnim.stop(),this.fxParticles.stopSystem(),this.highlight.active=!1),this._isAnimated=t);var n=s.phaseGetCompletionStr();if(n!=this._completion){this._completion=n;try{var o=n.indexOf("%");if(o>0)this.progressLabel.string=n,n=n.substring(0,o),this.progressBar.progress=Number(n)/100;else if((o=n.indexOf("/"))>0){var r=/\d+/g,c=n.match(r);this.progressBar.progress=Number(c[0])/Number(c[1]),this.progressLabel.string=(100*this.progressBar.progress).toLocaleString(void 0,{maximumFractionDigits:0})+"%"}else this.progressBar.progress=Number(n),this.progressLabel.string=(100*this.progressBar.progress).toLocaleString(void 0,{maximumFractionDigits:0})+"%"}catch(e){this.progressLabel.string=n,this.progressBar.progress=0}}}},onBtOpen:function(){a.questInfo.show()}});t.exports=o,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv"}],UIScore_croprotation:[function(e,t,n){"use strict";cc._RF.push(t,"b6098hR08JLhqWX764cWMcE","UIScore_croprotation");var i=e("./UIPopupBase"),a=e("../Game"),s=e("RscPreload"),o=e("./UIEnv"),r=(e("LanguageData"),new a,cc.Class({extends:i,editor:{menu:"gof/UIScore_croprotation"},properties:{scoreText:{default:null,type:cc.Label},itemPrefab:{default:null,type:cc.Prefab},scrollView:{default:null,type:cc.ScrollView}},statics:{instance:null},onLoad:function(){r.instance=this,o.score_croprotation=this,this.initPopup()},show:function(){o.parcel.hide(),o.speciesSelect.hide(),o.questInfo.hide(),this.showPopup()},onShow:function(){},setResults:function(e){var t=this.scrollView.content;t.removeAllChildren(!0);for(var n=0;n<e.length;n++){var i=cc.instantiate(this.itemPrefab),a=e[n],o=i.getChildByName("ParcelleName").getComponent(cc.Label);o&&(o.string=a.parcelName);var r=i.getChildByName("icon_note").getComponent(cc.Sprite);r&&(r.spriteFrame=s.instance.noteIconsAtlas.getSpriteFrame("note"+a.note)),i.setParent(t)}},setScoreText:function(e){this.scoreText.string=e},update:function(e){},onBtNext:function(){location.pathname="/dashboard",this.hide()}}));cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData",RscPreload:"RscPreload"}],UIScore:[function(e,t,n){"use strict";cc._RF.push(t,"3ac5eIDVhJJ/ofpayCfR0NL","UIScore");var i=e("./UIPopupBase"),a=e("../Game"),s=e("./UIEnv"),o=(e("LanguageData"),new a,cc.Class({extends:i,editor:{menu:"gof/UIScore"},properties:{drawingZone:{default:null,type:cc.Node},scoreText:{default:null,type:cc.Label}},statics:{instance:null},onLoad:function(){o.instance=this,s.score=this,this.initPopup(),this.spider=this.drawingZone.addComponent(cc.Graphics)},show:function(){s.parcel.hide(),s.speciesSelect.hide(),s.questInfo.hide(),this.showPopup()},onShow:function(){},setScore:function(e,t,n,i,a,s){this.scoreText.string=s;for(var o=this.spider,r=new cc.Vec2(-151,-66),c=[new cc.Vec2(0,1),new cc.Vec2(150,42),new cc.Vec2(84,-124),new cc.Vec2(-84,-124),new cc.Vec2(-150,42)],l=0;l<c.length;++l)c[l]=c[l].normalize();var u=[e,t,n,i,a];o.clear(),o.fillColor=new cc.Color(167,247,192,160),o.strokeColor=new cc.Color(142,162,105,160),o.lineWidth=6;for(var p=null,l=0;l<c.length;++l){var h=c[l].mul(160*u[l]),d=r.add(h);l?o.lineTo(d.x,d.y):(o.moveTo(d.x,d.y),p=d)}o.lineTo(p.x,p.y),o.stroke(),o.fill(),this.drawingZone.opacity=127},update:function(e){},onBtNext:function(){this.hide()}}));cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UISpeciesInfosItem:[function(e,t,n){"use strict";cc._RF.push(t,"fa349e/AsdHB4Nusn32H6u7","UISpeciesInfosItem");var i=e("LanguageData"),a=cc.Class({extends:cc.Component,editor:{menu:"gof/UISpeciesInfosItem"},properties:{procedureIndex:{default:null,type:cc.Label},procedureName:{default:null,type:cc.Label},procedureUnitPrice:{default:null,type:cc.Label},procedureUnitDuration:{default:null,type:cc.Label}},onLoad:function(){},init:function(e,t,n){this.procedureIndex.string=n.toString(),this.procedureName.string=i.t("procedure_"+t.name).toUpperCase(),0!=t.unitCosts.money?this.procedureUnitPrice.string=i.t("money_unit",{val:t.unitCosts.money.toLocaleString(void 0,{maximumFractionDigits:2})}):this.procedureUnitPrice.string="--",this.procedureUnitDuration.string=i.t("duration_unit",{val:t.unitCosts.time.toLocaleString(void 0,{maximumFractionDigits:2})})}});t.exports=a,cc._RF.pop()},{LanguageData:"LanguageData"}],UISpeciesInfosPopup:[function(e,t,n){"use strict";cc._RF.push(t,"ee618Ep861Jg7U/fhom6yXR","UISpeciesInfosPopup");var i=e("LanguageData"),a=e("./UIPopupBase"),s=e("../Game"),o=(e("./UISpeciesInfosItem"),e("./UIEnv")),r=e("../common/constants"),c=e("RscPreload"),l=(new s,cc.Class({extends:a,editor:{menu:"gof/UISpeciesInfosPopup"},properties:{itemPrefab:{default:null,type:cc.Prefab},scrollView:{default:null,type:cc.ScrollView},title:{default:null,type:cc.Label},speciesIcon:{default:null,type:cc.Sprite},speciesName:{default:null,type:cc.Label},btNormal:{default:null,type:cc.Button},btBio:{default:null,type:cc.Button},btReasoned:{default:null,type:cc.Button},totalPrice:{default:null,type:cc.Label},totalSell:{default:null,type:cc.Label},totalProfit:{default:null,type:cc.Label},hectarePrice:{default:null,type:cc.Label},hectareSell:{default:null,type:cc.Label},hectareProfit:{default:null,type:cc.Label},outputPanel:{default:null,type:cc.Node},ouputPrefab:{default:null,type:cc.Prefab},ouputScrollView:{default:null,type:cc.ScrollView},_parcel:{default:null,visible:!1},_plant:{default:null,visible:!1},_mode:{default:null,visible:!1}},statics:{instance:null},onLoad:function(){null!=l.instance&&cc.error("An instance of UISpeciesInfosPopup already exists"),l.instance=this,o.speciesInfos=this,this.initPopup()},show:function(e,t,n){this._parcel=e,this._plant=t,this._mode=n,this.speciesName.string=i.t("plant_"+this._plant.species).toUpperCase(),this.speciesIcon.spriteFrame=c.getPlantIcon(this._plant.species),this.title.string=i.t("activity_infos_title")+"\n"+this._parcel.name+" ("+i.t("surface_hectare",{val:this._parcel.surface.toLocaleString(void 0,{maximumFractionDigits:2})})+")",this.outputPanel.active=!1,this.showPopup()},onShow:function(){var e=this.scrollView.content;e.removeAllChildren(!0);var t=this.ouputScrollView.content;t.removeAllChildren(!0);var n=this._plant.getItk(this._mode);if(n&&n.procedures){this.hectarePrice.string=i.t("money_unit",{val:n.unitCosts.money.toLocaleString(void 0,{maximumFractionDigits:2})}),this.hectareSell.string=i.t("money_unit",{val:n.unitResults.money.toLocaleString(void 0,{maximumFractionDigits:2})}),this.hectareProfit.string=i.t("money_unit",{val:(n.unitResults.money-n.unitCosts.money).toLocaleString(void 0,{maximumFractionDigits:2})}),this.totalPrice.string=i.t("money_unit",{val:(n.unitCosts.money*this._parcel.surface).toLocaleString(void 0,{maximumFractionDigits:2})}),this.totalSell.string=i.t("money_unit",{val:(n.unitResults.money*this._parcel.surface).toLocaleString(void 0,{maximumFractionDigits:2})}),this.totalProfit.string=i.t("money_unit",{val:((n.unitResults.money-n.unitCosts.money)*this._parcel.surface).toLocaleString(void 0,{maximumFractionDigits:2})});for(var a=0;a<n.procedures.length;a++){var s=n.procedures[a];(u=cc.instantiate(this.itemPrefab)).setParent(e),(p=u.getComponent("UISpeciesInfosItem")).init(this._parcel,s,a+1)}for(var o=this._plant.getOutputs(this._mode),c=0;c<o.length;c++){var l=o[c],u=cc.instantiate(this.ouputPrefab);u.setParent(t);var p=u.getComponent("UIOutputInfoItem");p.init(this._parcel,l)}}else this.hectarePrice.string="",this.hectareSell.string="",this.hectareProfit.string="",this.totalPrice.string="",this.totalSell.string="",this.totalProfit.string="";this.btNormal.interactable=this._mode!=r.CultureModeEnum.NORMAL,this.btBio.interactable=this._mode!=r.CultureModeEnum.BIO,this.btReasoned.interactable=this._mode!=r.CultureModeEnum.REASONED,this.scrollView.scrollToTop()},onHide:function(){},onBtNormal:function(){this._mode=r.CultureModeEnum.NORMAL,this.onShow()},onBtBio:function(){this._mode=r.CultureModeEnum.BIO,this.onShow()},onBtReasoned:function(){this._mode=r.CultureModeEnum.REASONED,this.onShow()},onBtDetails:function(){this.outputPanel.active=!this.outputPanel.active}}));cc._RF.pop()},{"../Game":"Game","../common/constants":"constants","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase","./UISpeciesInfosItem":"UISpeciesInfosItem",LanguageData:"LanguageData",RscPreload:"RscPreload"}],UISpeciesSelItem:[function(e,t,n){"use strict";cc._RF.push(t,"aaef9bEqX5BcJFGX/hbg8UC","UISpeciesSelItem");var i=e("LanguageData"),a=(e("Plant"),e("RscPreload")),s=e("../common/constants"),o=e("./UIEnv"),r=cc.Class({extends:cc.Component,editor:{menu:"gof/UISpeciesSelItem"},properties:{speciesName:{default:null,type:cc.Label},speciesVariety:{default:null,type:cc.Label},speciesIcon:{default:null,type:cc.Sprite},buyPriceNormal:{default:null,type:cc.Label},sellPriceNormal:{default:null,type:cc.Label},btNormal:{default:null,type:cc.Button},buyPriceBio:{default:null,type:cc.Label},sellPriceBio:{default:null,type:cc.Label},btBio:{default:null,type:cc.Button},buyPriceReasoned:{default:null,type:cc.Label},sellPriceReasoned:{default:null,type:cc.Label},btReasoned:{default:null,type:cc.Button},btAdd:{default:null,type:cc.Button},btInfo:{default:null,type:cc.Button},hlSelected:{default:null,type:cc.Node},isSelected:{visible:!1,get:function(){return this._isSelected},set:function(e){this._isSelected!==e&&(this._isSelected=e,e&&null!==this.selectionCallback&&this.selectionCallback(this),this._selectionChanged=!0)}},plant:{visible:!1,get:function(){return this._plant},set:function(e){this._plant=e,this._plantChanged=!0}},cultureMode:{visible:!1,get:function(){return this._cultureMode},set:function(e){this._cultureMode=e,this._cultureChanged=!0}},_cultureMode:{default:s.CultureModeEnum.NORMAL,visible:!1},selectionCallback:{visible:!1,default:null,type:Object},validationCallback:{visible:!1,default:null,type:Object}},_plant:null,_plantChanged:!1,_cultureChanged:!1,_isSelected:!1,_selectionChanged:!1,onLoad:function(){this.speciesVariety.string="",this.hlSelected.active=!1},updateUI:function(){if(null!=this._plant){if(this._plantChanged&&(this.speciesName.string=i.t("plant_"+this._plant.species).toUpperCase(),this.speciesIcon.spriteFrame=a.getPlantIcon(this._plant.species),this._plantChanged=!1,this._selectionChanged=!0,this._cultureChanged=!0),this._cultureChanged)if(this._plant.isFallow)this.buyPriceNormal.string="",this.buyPriceBio.string="",this.buyPriceReasoned.string="",this.sellPriceNormal.string="",this.sellPriceBio.string="",this.sellPriceReasoned.string="",this.btNormal.node.active=!1,this.btBio.node.active=!1,this.btReasoned.node.active=!1;else{var e=this._plant.getItk(s.CultureModeEnum.NORMAL);e&&e.unitCosts?(this.buyPriceNormal.string=i.t("money_unit",{val:e.unitCosts.money.toLocaleString(void 0,{maximumFractionDigits:2})}),this.sellPriceNormal.string=i.t("money_unit",{val:e.unitResults.money.toLocaleString(void 0,{maximumFractionDigits:2})})):(this.buyPriceNormal.string=i.t("money_unit",{val:this._plant.getBuyPrice(s.CultureModeEnum.NORMAL).toLocaleString(void 0,{maximumFractionDigits:2})}),this.sellPriceNormal.string=i.t("money_unit",{val:this._plant.getSellPrice(s.CultureModeEnum.NORMAL).toLocaleString(void 0,{maximumFractionDigits:2})}));var t=this._plant.getItk(s.CultureModeEnum.BIO);t&&t.unitCosts?(this.buyPriceBio.string=i.t("money_unit",{val:t.unitCosts.money.toLocaleString(void 0,{maximumFractionDigits:2})}),this.sellPriceBio.string=i.t("money_unit",{val:t.unitResults.money.toLocaleString(void 0,{maximumFractionDigits:2})})):(this.buyPriceBio.string=i.t("money_unit",{val:this._plant.getBuyPrice(s.CultureModeEnum.BIO).toLocaleString(void 0,{maximumFractionDigits:2})}),this.sellPriceBio.string=i.t("money_unit",{val:this._plant.getSellPrice(s.CultureModeEnum.BIO).toLocaleString(void 0,{maximumFractionDigits:2})}));var n=this._plant.getItk(s.CultureModeEnum.REASONED);n&&n.unitCosts?(this.buyPriceReasoned.string=i.t("money_unit",{val:n.unitCosts.money.toLocaleString(void 0,{maximumFractionDigits:2})}),this.sellPriceReasoned.string=i.t("money_unit",{val:n.unitResults.money.toLocaleString(void 0,{maximumFractionDigits:2})})):(this.buyPriceReasoned.string=i.t("money_unit",{val:this._plant.getBuyPrice(s.CultureModeEnum.REASONED).toLocaleString(void 0,{maximumFractionDigits:2})}),this.sellPriceReasoned.string=i.t("money_unit",{val:this._plant.getSellPrice(s.CultureModeEnum.REASONED).toLocaleString(void 0,{maximumFractionDigits:2})})),this.btNormal.interactable=this.cultureMode!=s.CultureModeEnum.NORMAL,this.btBio.interactable=this.cultureMode!=s.CultureModeEnum.BIO,this.btReasoned.interactable=this.cultureMode!=s.CultureModeEnum.REASONED}this._plant.getItk(s.CultureModeEnum.NORMAL)?this.btInfo.interactable=!0:this.btInfo.interactable=!1,this._selectionChanged&&(this.hlSelected.active=this._isSelected)}},update:function(e){this.updateUI()},onBtCultureNormal:function(){null==this._plant||this._plant.isFallow||(this.cultureMode=s.CultureModeEnum.NORMAL)},onBtCultureBio:function(){null==this._plant||this._plant.isFallow||(this.cultureMode=s.CultureModeEnum.BIO)},onBtCultureReasoned:function(){null==this._plant||this._plant.isFallow||(this.cultureMode=s.CultureModeEnum.REASONED)},onBtCulturePerma:function(){null==this._plant||this._plant.isFallow||(this.cultureMode=s.CultureModeEnum.PERMACULTURE)},onBtAdd:function(){null!=this._plant&&null!=this.validationCallback&&this.validationCallback({species:this._plant.species,culture:this._cultureMode})},onBtInfo:function(){null!=this._plant&&o.speciesInfos.show(o.speciesSelect._parcel,this._plant,this._cultureMode)}});t.exports=r,cc._RF.pop()},{"../common/constants":"constants","./UIEnv":"UIEnv",LanguageData:"LanguageData",Plant:"Plant",RscPreload:"RscPreload"}],UISpeciesSelPopup:[function(e,t,n){"use strict";cc._RF.push(t,"be3ddDBLZpLTbjtJ2jb+FZn","UISpeciesSelPopup");var i=e("./UIPopupBase"),a=e("../Game"),s=(e("./UISpeciesSelItem"),e("./UIEnv")),o=new a,r=cc.Class({extends:i,editor:{menu:"gof/UISpeciesSelPopup"},properties:{itemPrefab:{default:null,type:cc.Prefab},scrollView:{default:null,type:cc.ScrollView},_parcel:{default:null,visible:!1},_previsionYear:{default:-1,visible:!1}},statics:{instance:null},onLoad:function(){null!=r.instance&&cc.error("An instance of UISpeciesSelPopup already exists"),r.instance=this,s.speciesSelect=this,this.initPopup()},show:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this._parcel=e,this._previsionYear=t,this.showPopup()},onShow:function(){var e=null;this._previsionYear>=0&&this._previsionYear<this._parcel.rotationPrevision.length&&(e=this._parcel.rotationPrevision[this._previsionYear]);var t=this.scrollView.content;t.removeAllChildren(!0);for(var n=0;n<o.plants.length;n++)if(!(o.farm.plantExcludes.indexOf(o.plants[n].species)>-1)){var i=cc.instantiate(this.itemPrefab);i.setParent(t);var a=i.getComponent("UISpeciesSelItem");a.plant=o.plants[n],a.selectionCallback=this.onItemSelection,a.validationCallback=this.onItemValidation,null!==e&&e.species==a.plant.species&&(e.culture&&(a.cultureMode=e.culture),a.isSelected=!0)}},onHide:function(){},onItemSelection:function(e){for(var t=r.instance.scrollView.content.children,n=0;n<t.length;n++){var i=t[n].getComponent("UISpeciesSelItem");i.isSelected&&e.plant!==i.plant&&(i.isSelected=!1)}},onItemValidation:function(e){var t=r.instance;t._previsionYear>=0&&t._previsionYear<t._parcel.rotationPrevision.length?t._parcel.rotationPrevision[t._previsionYear]=e:t._parcel.rotationPrevision.push(e),o.saveChannel(),s.parcel.updateRotationPrevisions(),t.hide()},onBtClose:function(){this.hide()}});t.exports=r,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase","./UISpeciesSelItem":"UISpeciesSelItem"}],UITop:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}cc._RF.push(t,"5d170x4gqNGn6wYSkUsy2s+","UITop");var a=i(e("Game")),s=(i(e("Farm")),new a.default),o=e("LanguageData");cc.Class({extends:cc.Component,editor:{menu:"gof/UITop"},properties:{dateLabel:{default:null,type:cc.RichText},moneyLabel:{default:null,type:cc.Label}},onLoad:function(){this.moneyLabel.string="",this.dateLabel.string=""},start:function(){},update:function(e){if(null!=s.phase){var t=s.farm;this.moneyLabel.string=s.farm.money;var n=o.t("month_"+(t.month+1));this.dateLabel.string=o.t("date_value",{year:t.year,month:n,week:t.week+1})}}}),cc._RF.pop()},{Farm:"Farm",Game:"Game",LanguageData:"LanguageData"}],UsableItem:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"cdffbW74nlJB4VaXT8j1d7G","UsableItem"),Object.defineProperty(n,"__esModule",{value:!0});n.default=function e(t){i(this,e),this.dbId=t._id,this.name=t.name,this.pricePerUnit=Number(t.price),this.unit=t.unit,this._valid=this.dbId&&this.name&&this.pricePerUnit},t.exports=n.default,cc._RF.pop()},{}],constants:[function(e,t,n){"use strict";cc._RF.push(t,"a3409Ylha9I4Zk4lNHwejqQ","constants"),t.exports=Object.freeze({CultureModeEnum:{NORMAL:"normal",BIO:"bio",PERMACULTURE:"permaculture",REASONED:"reasoned"},UserRoleEnum:{MASTER:"master",STUDENT:"student",PROFESSIONAL:"professional",OTHER:"other"},ChannelStateEnum:{OPENED:"opened",CLOSED:"closed"}}),cc._RF.pop()},{}],"polyglot.min":[function(e,t,n){"use strict";cc._RF.push(t,"e26fd9yy65A4q3/JkpVnFYg","polyglot.min");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,a){"function"==typeof define&&define.amd?define([],function(){return a(e)}):"object"==(void 0===n?"undefined":i(n))?t.exports=a(e):e.Polyglot=a(e)}(void 0,function(e){function t(e){e=e||{},this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en",this.allowMissing=!!e.allowMissing,this.warn=e.warn||l}function n(e){var t,n,i,a={};for(t in e)if(e.hasOwnProperty(t)){n=e[t];for(i in n)a[n[i]]=t}return a}function a(e){var t=/^\s+|\s+$/g;return e.replace(t,"")}function s(e,t,n){var i,s,o;return null!=n&&e?(s=e.split(p),o=s[r(t,n)]||s[0],i=a(o)):i=e,i}function o(e){var t=n(d);return t[e]||t.en}function r(e,t){return h[o(e)](t)}function c(e,t){for(var n in t)"_"!==n&&t.hasOwnProperty(n)&&(e=e.replace(new RegExp("%\\{"+n+"\\}","g"),t[n]));return e}function l(t){e.console&&e.console.warn&&e.console.warn("WARNING: "+t)}function u(e){var t={};for(var n in e)t[n]=e[n];return t}t.VERSION="0.4.3",t.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},t.prototype.extend=function(e,t){var n;for(var a in e)e.hasOwnProperty(a)&&(n=e[a],t&&(a=t+"."+a),"object"==(void 0===n?"undefined":i(n))?this.extend(n,a):this.phrases[a]=n)},t.prototype.clear=function(){this.phrases={}},t.prototype.replace=function(e){this.clear(),this.extend(e)},t.prototype.t=function(e,t){var n,i;return"number"==typeof(t=null==t?{}:t)&&(t={smart_count:t}),"string"==typeof this.phrases[e]?n=this.phrases[e]:"string"==typeof t._?n=t._:this.allowMissing?n=e:(this.warn('Missing translation for key: "'+e+'"'),i=e),"string"==typeof n&&(t=u(t),i=s(n,this.currentLocale,t.smart_count),i=c(i,t)),i},t.prototype.has=function(e){return e in this.phrases};var p="||||",h={chinese:function(e){return 0},german:function(e){return 1!==e?1:0},french:function(e){return e>1?1:0},russian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){return 1===e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0}},d={chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru"],czech:["cs"],polish:["pl"],icelandic:["is"]};return t}),cc._RF.pop()},{}]},{},["ApiClient","Farm","Game","GamePhase","MapCtrl","Parcel","ParcelSetup","Plant","RscPreload","Startup","LocalizedLabelExt","UIBottom","UICheat","UIDebug","UIEnv","UIMessage","UIOffice","UIOutputInfoItem","UIParcel","UIParcelButton","UIParcelHistoryItem","UIPopupBase","UIQuestInfo","UIQuestIntro","UIQuestMenu","UIScore","UIScore_croprotation","UISpeciesInfosItem","UISpeciesInfosPopup","UISpeciesSelItem","UISpeciesSelPopup","UITop","UsableItem","constants","LanguageData","LocalizedLabel","LocalizedSprite","SpriteFrameSet","polyglot.min"]);