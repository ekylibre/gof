require=function e(t,n,i){function a(r,o){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!o&&c)return c(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return a(n?n:e)},u,u.exports,e,t,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)a(i[r]);return a}({ApiClient:[function(e,t,n){"use strict";function i(e){this.endPoint=e;var t=document.getElementById("GameCanvas"),n=t.getAttribute("gof-access-token")||localStorage.getItem("gof-access-token");n&&(this.accessToken=n)}function a(e){if(!e)return"";for(var t="",n=Object.keys(e),i=0;i<n.length;++i)i>0&&(t+="&"),t+=n[i]+"="+encodeURIComponent(e[n[i]]);return t.length>0?t:null}function s(e,t,n,i){return o(e,"GET",t,n,i)}function r(e,t,n){var i=o(e,"POST",t,null,n);return i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i}function o(e,t,n,i,s){var r=new XMLHttpRequest,o=a(i),c=e.endPoint+n+(o.length?"?"+o:"");return r.open(t,c,!0),e.accessToken&&r.setRequestHeader("Authorization","Bearer "+e.accessToken),r.onreadystatechange=function(t){if(4==r.readyState){var n=null;try{n=JSON.parse(r.responseText)}catch(i){}return 200!==r.status&&s?void s(n,null,e):void(s&&s(null,n,e))}},r}cc._RF.push(t,"a5aaaraT9pJs4mh90pQOvW8","ApiClient"),i.prototype.checkAuth=function(e){var t=s(this,"/auth/check",null,e);t.send(null)},i.prototype.login=function(e,t,n){var i=r(this,"/auth/login",function(e,t,i){t&&(i.accessToken=t.payload.accessToken),n(e,t,i)}),s=a({email:e,password:t});i.send(s)},i.prototype.getPlant=function(e,t){var n=s(this,"/plants/"+encodeURIComponent(e),null,t);n.send()},i.prototype.getPlants=function(e,t){var n=s(this,"/plants",e,t);n.send()},i.prototype.getScenarios=function(e,t){var n=null;n=e?s(this,"/scenarios/"+encodeURIComponent(e),null,t):s(this,"/scenarios",null,t),n.send()},t.exports=i,cc._RF.pop()},{}],1:[function(e,t,n){"use strict";t.exports=Object.freeze({CultureModeEnum:{NORMAL:"normal",BIO:"bio",PERMACULTURE:"permaculture"}})},{}],Farm:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"a0071wrzthDjJMdvjOEmTUS","Farm"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=(e("Parcel"),e("GamePhase"),function(){function e(t,n){i(this,e),this.name=t,void 0===n?this.totalSurface=0:this.totalSurface=n,this.surfacePerTile=1,this.parcels=[],this.possibleSpecies=[],this.money=0,this.year=0,this.month=0,this.week=0}return a(e,[{key:"addParcel",value:function(e){this.parcels.push(e)}},{key:"findParcelAt",value:function(e){for(var t=0;t<this.parcels.length;t++){var n=this.parcels[t];if(n.hasTile(e))return n}return null}},{key:"findParcelAdjacent",value:function(e){for(var t=0;t<this.parcels.length;t++){var n=this.parcels[t];if(n.isAdjacent(e))return n}return null}},{key:"findParcelUID",value:function(e){if(void 0!==e){var t=this.parcels.find(function(t){return t.uid==e});if(void 0!==t)return t}return null}}]),e}());n["default"]=s,t.exports=n["default"],cc._RF.pop()},{GamePhase:"GamePhase",Parcel:"Parcel"}],GameParcel:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"0f957aWFChBMZjyNBE3iwfh","GameParcel"),Object.defineProperty(n,"__esModule",{value:!0});var a=function s(){i(this,s)};n["default"]=a,t.exports=n["default"],cc._RF.pop()},{}],GamePhase:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"3ac1bWprMFKCozrFNz9biyB","GamePhase"),Object.defineProperty(n,"__esModule",{value:!0});var a=function s(){i(this,s),this.uid="assolement",this.startMoney=5e4,this.startMonth=7,this.startWeek=3,this.introTextId=null,this.objctiveTextId=null,this.startYearDiff=0,this.perfectScore=0,this.maxPrevisions=1,this.endCondition="false",this.completionStr="",this.plantExcludes=[],this.parcels=[{uid:"parcel1",history:[{species:"ble",culture:"bio"},{species:"orge",culture:"normal"}]}]};n["default"]=a,t.exports=n["default"],cc._RF.pop()},{}],Game:[function(require,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(module,"37f159UDU9GBpEOdPYC0xWt","Game"),Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_class,_temp,CGamePhase=require("./GamePhase"),CGameParcel=require("./GameParcel"),CFarm=require("./Farm"),CPlant=require("./Plant"),i18n=require("LanguageData"),SharedConsts=require("../../../common/constants"),ApiClient=require("./ApiClient"),UIDebug=require("./UI/UIDebug"),UIEnv=require("./UI/UIEnv"),DEBUG=!0,ConfigDebug={LANGUAGE_DEFAULT:"fr",MAP_ZOOM_MAX:1.7,MAP_ZOOM_MIN:.1},ConfigMaster={LANGUAGE_DEFAULT:"fr",MAP_ZOOM_MAX:1,MAP_ZOOM_MIN:.4},instance=null,CGame=(_temp=_class=function(){function CGame(){if(_classCallCheck(this,CGame),this.state=CGame.State.INVALID,this._currPhase=null,this._startYear=0,instance)return instance;instance=this,this.isDebug=DEBUG,this.constants=SharedConsts,DEBUG?this.config=ConfigDebug:this.config=ConfigMaster,i18n.init(this.config.LANGUAGE_DEFAULT),this.farm=new CFarm;var e=new Date(Date.now());this.farm.year=e.getFullYear(),this.plants=[]}return _createClass(CGame,[{key:"findPlant",value:function(e){if(void 0!==e&&null!=e){var t=this.plants.find(function(t){return t.species==e});if(void 0!==t)return t}return null}},{key:"pullDatabase",value:function(){return this.api?void this.api.getPlants(null,function(e,t,n){if(e)return UIEnv.message.show(i18n.t("error_connection_failed")+"\n\n("+e+")",i18n.t("error"),{buttons:"none"}),void UIDebug.log("Error: Failed to get plants:"+e);if(t&&Array.isArray(t)){UIDebug.log("Pulled plants: "+t.length);for(var i=0;i<t.length;i++){var a=t[i],s=instance.findPlant(a.species);null!=s?s.updatePrices(a):(s=new CPlant(a),s._valid&&instance.plants.push(s))}instance.state=CGame.State.READY}else UIEnv.message.show(i18n.t("error_connection_failed"),i18n.t("error"),{buttons:"none"}),UIDebug.log("Error: Invalid response for getPlants: "+t)}):void cc.error("Please setup CGame.api")}},{key:"phaseStart",value:function(){this.state==CGame.State.PHASE_READY?this.state=CGame.State.PHASE_RUN:cc.error("Invalid state to start a phase: "+Object.keys()[this.state+1])}},{key:"phaseFinish",value:function(){}},{key:"phaseCanFinish",value:function phaseCanFinish(){return eval(this._currPhase.endCondition)===!0}},{key:"phaseGetCompletionStr",value:function phaseGetCompletionStr(){return eval(this._currPhase.completionStr)}},{key:"phaseGetIntroText",value:function(){return i18n.t(this._currPhase.introTextId)}},{key:"phaseGetObjectiveText",value:function(){return i18n.t(this._currPhase.objectiveTextId)}},{key:"loadPhase",value:function(e,t){var n=this;this.state=CGame.State.PHASE_LOAD,this.api.getScenarios(e,function(i,a){if(i)return void t(new Error("Error: Failed to get scenario with uid:"+e+" "+i));if(a.scenario.start.farm.parcels.length>n.farm.parcels.length)return void t(new Error("Error: the scenario "+e+" contains more parcels than the current gfx farm"));var s=new CGamePhase;s.uid=e,s.startMoney=a.scenario.start.farm.treasury,s.startMonth=a.scenario.start.date.month,s.startWeek=a.scenario.start.date.week,s.startYearDiff=a.scenario.start.date.yearDiff,s.introTextId=a.scenario.start.introTextId,s.objectiveTextId=a.scenario.start.objectiveTextId,s.perfectScore=a.scenario.start.score,s.endCondition=a.scenario.end.condition,s.completionStr=a.scenario.end.completionStr,s.plantExcludes=a.scenario.start.farm.excludes,"croprotation"===e?s.maxPrevisions=1:s.maxPrevisions=0,s.parcels=new Array;for(var r=0;r<a.scenario.start.farm.parcels.length;++r){var o=a.scenario.start.farm.parcels[r],c=new CGameParcel;c.uid=o.uid,c.solution=o.data.solution,c.history=new Array;for(var l=0;l<o.data.rotationHistory.length;++l)c.history.push(o.data.rotationHistory[l]);s.parcels.push(c)}n.phase=s,t(null)})}},{key:"createRandomPhase",value:function(){this.phase=new CGamePhase;for(var e=0;e<this.farm.parcels.length;e++){var t=this.farm.parcels[e];t.rotationHistory=[];for(var n=0;n<5;n++){var i=Math.floor(cc.random0To1()*this.plants.length);i==this.plants.length&&i--;var a=this.plants[i],s=SharedConsts.CultureModeEnum.NORMAL;i=Math.floor(3*cc.random0To1()),1==i&&(s=SharedConsts.CultureModeEnum.BIO),2==i&&(s=SharedConsts.CultureModeEnum.PERMACULTURE),t.rotationHistory.push({species:a.species,culture:s})}}}},{key:"phase",get:function(){return this._currPhase},set:function(e){if(void 0!==e&&null!==e){if(null!==this._currPhase&&this._currPhase.uid==e.uid)return;if(this.farm.month=e.startMonth,this.farm.week=e.startWeek,null===this._currPhase){this.farm.money=e.startMoney,this.farm.plantExcludes=e.plantExcludes;for(var t=0;t<e.parcels.length;t++){var n=e.parcels[t],i=this.farm.findParcelUID(n.uid);null!=i?(i.rotationHistory=n.history,i.solution=n.solution):cc.error("Could not find parcel uid "+n.uid)}}else this.farm.year+=e.startYearDiff;this._currPhase=e,this.state=CGame.State.PHASE_READY}else this._currPhase=null,this.state!=CGame.State.INVALID&&(this.state=CGame.State.READY)}}]),CGame}(),_class.State={INVALID:-1,READY:0,PHASE_SELECT:10,PHASE_LOAD:11,PHASE_READY:12,PHASE_RUN:13,PHASE_SCORE:14},_temp);exports["default"]=CGame,module.exports=exports["default"],cc._RF.pop()},{"../../../common/constants":1,"./ApiClient":"ApiClient","./Farm":"Farm","./GameParcel":"GameParcel","./GamePhase":"GamePhase","./Plant":"Plant","./UI/UIDebug":"UIDebug","./UI/UIEnv":"UIEnv",LanguageData:"LanguageData"}],LanguageData:[function(e,t,n){"use strict";function i(e){return window.i18n.languages[e]}function a(e){e&&(r?r.replace(e):r=new s({phrases:e,allowMissing:!0}))}cc._RF.push(t,"61de062n4dJ7ZM9/Xdumozn","LanguageData");var s=e("polyglot.min"),r=null;window.i18n||(window.i18n={languages:{},curLang:""}),t.exports={init:function(e){if(!e||e!==window.i18n.curLang){var t=null;e?(t=i(e),window.i18n.curLang=e):t=i(window.i18n.curLang),a(t)}},t:function(e,t){if(r)return r.t(e,t)},inst:r,updateSceneRenderers:function(){for(var e=cc.director.getScene().children,t=[],n=0;n<e.length;++n){var i=e[n].getComponentsInChildren("LocalizedLabel");Array.prototype.push.apply(t,i)}for(var a=0;a<t.length;++a){var s=t[a];s.updateLabel()}for(var r=[],o=0;o<e.length;++o){var c=e[o].getComponentsInChildren("LocalizedSprite");Array.prototype.push.apply(r,c)}for(var l=0;l<r.length;++l){var u=r[l];u.updateSprite(window.i18n.curLang)}}},cc._RF.pop()},{"polyglot.min":"polyglot.min"}],LocalizedLabelExt:[function(e,t,n){"use strict";cc._RF.push(t,"7eb01WD8EJDeZNKJNi9e5fa","LocalizedLabelExt");var i=e("LanguageData");cc.Class({"extends":cc.Component,editor:{executeInEditMode:!0,menu:"i18n/LocalizedTextExt"},properties:{dataID:{get:function(){return this._dataID},set:function(e){this._dataID!==e&&(this._dataID=e,this.updateLabel())}},_dataID:"",forceUppercase:{get:function(){return this._forceUppercase},set:function(e){this._forceUppercase!==e&&(this._forceUppercase=e,this.updateLabel())}},_forceUppercase:!1},onLoad:function(){i.inst||i.init(),this.fetchRender()},fetchRender:function(){var e=this.getComponent(cc.Label);if(e||(e=this.getComponent(cc.RichText)),e)return this.label=e,void this.updateLabel()},updateLabel:function(){if(!this.label)return void cc.error("Failed to update localized text!");var e=i.t(this.dataID);e?(this.forceUppercase&&(e=e.toUpperCase()),this.label.string=e):cc.warn("Missing text id: "+this.dataID)}}),cc._RF.pop()},{LanguageData:"LanguageData"}],LocalizedLabel:[function(e,t,n){"use strict";cc._RF.push(t,"744dcs4DCdNprNhG0xwq6FK","LocalizedLabel");var i=e("LanguageData");cc.Class({"extends":cc.Component,editor:{executeInEditMode:!0,menu:"i18n/LocalizedLabel"},properties:{dataID:{get:function(){return this._dataID},set:function(e){this._dataID!==e&&(this._dataID=e,this.updateLabel())}},_dataID:""},onLoad:function(){i.inst||i.init(),this.fetchRender()},fetchRender:function(){var e=this.getComponent(cc.Label);if(e)return this.label=e,void this.updateLabel()},updateLabel:function(){if(!this.label)return void cc.error("Failed to update localized label, label component is invalid!");var e=i.t(this.dataID);e&&(this.label.string=i.t(this.dataID))}}),cc._RF.pop()},{LanguageData:"LanguageData"}],LocalizedSprite:[function(e,t,n){"use strict";cc._RF.push(t,"f34ac2GGiVOBbG6XlfvgYP4","LocalizedSprite");var i=e("SpriteFrameSet");cc.Class({"extends":cc.Component,editor:{executeInEditMode:!0,inspector:"packages://i18n/inspector/localized-sprite.js",menu:"i18n/LocalizedSprite"},properties:{spriteFrameSet:{"default":[],type:i}},onLoad:function(){this.fetchRender()},fetchRender:function(){var e=this.getComponent(cc.Sprite);if(e)return this.sprite=e,void this.updateSprite(window.i18n.curLang)},getSpriteFrameByLang:function(e){for(var t=0;t<this.spriteFrameSet.length;++t)if(this.spriteFrameSet[t].language===e)return this.spriteFrameSet[t].spriteFrame},updateSprite:function(e){if(!this.sprite)return void cc.error("Failed to update localized sprite, sprite component is invalid!");var t=this.getSpriteFrameByLang(e);!t&&this.spriteFrameSet[0]&&(t=this.spriteFrameSet[0].spriteFrame),this.sprite.spriteFrame=t}}),cc._RF.pop()},{SpriteFrameSet:"SpriteFrameSet"}],MapCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"e2e73B/wgFOW6TFModC0XXp","MapCtrl");var i=e("./Game"),a=(e("./GamePhase"),e("./Farm"),e("./Parcel")),s=e("./UI/UIParcelButton"),r=e("./UI/UIEnv"),o=e("./UI/UIOffice"),c=e("./UI/UIDebug"),l=e("LanguageData"),u=new i,p=cc.Class({"extends":cc.Component,editor:{requireComponent:cc.ScrollView,menu:"gof/MapCtrl"},properties:{mapUILayer:{"default":null,type:cc.Node,displayName:"UI layer"},startOffset:{"default":new cc.Vec2(0,0),displayName:"Scroll starting pos"},mapParcels:{"default":[],type:[cc.TiledMap],displayName:"Parcels maps"},mapSprouts:{"default":[],type:[cc.TiledMap],displayName:"Sprouts maps"},mapObjects:{"default":[],type:[cc.TiledMap],displayName:"Objects maps"},parcelsGID:{"default":[],type:[cc.Integer],displayName:"Parcels GID"},parcelButtonPrefab:{"default":null,type:cc.Prefab,displayName:"Prefab Parcels button"},debugLabelPrefab:{"default":null,type:cc.Prefab}},statics:{instance:null},_mapScrollView:null,_refMap:null,_refLayer:null,_refSize:null,onLoad:function(){null==p.instance?p.instance=this:cc.error("An instance of MapCtrl already exists"),this._mapScrollView=this.getComponent(cc.ScrollView),this._mapStartSize=this._mapScrollView.content.getContentSize(),this.initTouch()},start:function(e){e||(this._mapScrollView.scrollToOffset(this.startOffset),this.findParcels(),u.isDebug&&this.addDebugInfo())},update:function(e){switch(u.state){case i.State.READY:u.loadPhase("croprotation",function(e){return e?(r.message.show(l.t("error_connection_failed")+"\n\n("+e+")",l.t("error"),{buttons:"none"}),void c.log(e)):void c.log("Phase started: "+u.phase.uid)});break;case i.State.PHASE_READY:r.questIntro.show()}},checkMapBorders:function(){var e=cc.v2(this._mapScrollView.node.width/2,this._mapScrollView.node.height/2);e=this._refMap.node.convertToNodeSpace(e),e=this.pixelToTile(e,!0);var t=1,n=this._refMap.getMapSize(),i=0;e.x<-t&&(i=-e.x+t,e.x=-t),e.x>=n.width+t&&(i+=e.x-(n.width+t),e.x=n.width+t-1),e.y<-t&&(i+=-e.y+t,e.y=-t),e.y>=n.height+t&&(i+=e.y-(n.height+t),e.y=n.height+t-1),i>0&&(e=this.tileToPixel(e),e=this.pixelToScroll(e),e.x-=this._mapScrollView.node.width/2,e.y-=this._mapScrollView.node.height/2,this._mapScrollView.scrollToOffset(e,.1*i))},initTouch:function(){var e=this;if(this.mapParcels&&this.mapParcels.length>0)this._refMap=this.mapParcels[0],this._refLayer=this._refMap.allLayers()[0];else{if(!(this.mapSprouts&&this.mapSprouts.length>0))return void cc.error("At least one parcel or sprout TiledMap is required");this._refMap=this.mapSprouts[0],this._refLayer=this._refMap.allLayers()[0]}var t=this._refMap.getMapSize(),n=this._refMap.getTileSize();this._refSize=cc.v2(t.width*n.width,t.height*n.height),this._mapScrollView._onMouseWheel=function(e,t){var n=.05;e.getScrollY()<0&&(n=-n);var i=this.content.scaleX+n;i<u.config.MAP_ZOOM_MIN&&(i=u.config.MAP_ZOOM_MIN),i>u.config.MAP_ZOOM_MAX&&(i=u.config.MAP_ZOOM_MAX),this.content.scaleX=i,this.content.scaleY=i,this.content.width=p.instance._refSize.x*i,this.content.height=p.instance._refSize.y*i,this._stopPropagationIfTargetIsMe(e),p.instance.checkMapBorders()},this.node.on(cc.Node.EventType.TOUCH_START,function(t){e._scrollLen=0},this.node),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){e._scrollLen+=cc.pLength(t.touch.getDelta())},this.node),this.node.on(cc.Node.EventType.TOUCH_END,function(t){if(e._scrollLen>2)return e._scrollLen=0,void p.instance.checkMapBorders();var n=t.touch,i=e._refMap.node.convertToNodeSpace(n.getLocation());if(c.touchLog=""+n.getLocationX()+","+n.getLocationY()+" => "+i,e.mapObjects&&e.mapObjects.length>0)for(var a=0;a<e.mapObjects.length;a++)if(e.touchOnMap(e.mapObjects[a],i))return;if(e.mapSprouts&&e.mapSprouts.length>0)for(var a=0;a<e.mapSprouts.length;a++)if(e.touchOnMap(e.mapSprouts[a],i))return;if(e.mapParcels&&e.mapParcels.length>0)for(var a=0;a<e.mapParcels.length;a++)if(e.touchOnMap(e.mapParcels[a],i))return},this.node)},touchOnMap:function(e,t){var n=e.allLayers(),i=this.pixelToTile(t);if(null==i)return!1;for(var a=e.getObjectGroups(),s=a.length-1;s>=0;s--)for(var r=a[s],l=r.getObjects(),p=0;p<l.length;p++){var h=l[p],d=.15,f=h.sgNode.width*(1-2*d),g=f/2,m=h.sgNode.height*d,v=h.sgNode.height*(1-2*d),_=cc.rect(h.sgNode.x-g,h.sgNode.y+m,f,v);if(_.contains(t))return u.isDebug&&c.log("Clicked on object "+h.name),o.instance.show(),!0}for(var s=n.length-1;s>=0;s--){var P=n[s],y=P.getTileGIDAt(i);if(0!=y){if(u.isDebug){var b="Clicked on layer "+P.getLayerName()+" tile("+i.x+","+i.y+") GID="+y,I=u.farm.findParcelAt(i);null!=I&&(b+=" Parcel: "+I.name),c.log(b)}return!0}}return!1},pixelToTile:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._refMap.getMapSize(),i=this._refLayer.getMapTileSize().width,a=this._refLayer.getMapTileSize().height,s=this._refLayer.getLayerSize().width,r=this._refLayer.getLayerSize().height,o=1*e.x,c=1*e.y,l=Math.floor(r-c/a+o/i-s/2),u=Math.floor(r-c/a-o/i+s/2);return t||l>=0&&u>=0&&l<n.width&&u<n.height?cc.v2(l,u):null},pixelToScroll:function(e){var t=this._mapScrollView.content.scaleX;return cc.v2(e.x*t,(this._refSize.y-e.y)*t)},tileToPixel:function(e){var t=this._refLayer.getPositionAt(e);return t},tileToUI:function(e){var t=this._refMap.getTileSize(),n=this._refLayer.getPositionAt(e);return n.x+=.5*t.width,n.y+=.5*t.height,this.mapToUI(n)},mapToUI:function(e){return cc.v2(e.x-.5*this.mapUILayer.width,e.y-.5*this.mapUILayer.height)},findParcels:function(){if(this.mapParcels&&this.parcelsGID&&this.parcelsGID.length>0)for(var e=0,t=0;t<this.mapParcels.length;t++){for(var n=this.mapParcels[t].getMapSize(),i=0;i<this.mapParcels[t].allLayers().length;i++)for(var r=this.mapParcels[t].allLayers()[i],o=0;o<n.height;o++)for(var c=0;c<n.width;c++)if(this.parcelsGID.includes(r.getTileGIDAt(c,o))){var p=new cc.Vec2(c,o),h=u.farm.findParcelAdjacent(p);if(null!=h&&h.tiledLayer==r)h.addTile(p);else{var d="parcel"+(u.farm.parcels.length+1),f=l.t("parcel")+" "+String(u.farm.parcels.length+1);h=new a(d,f,r),h.addTile(p),u.farm.addParcel(h)}e++}cc.log("TODO: setup the total surface from a metadata in the map?"),u.farm.totalSurface=55,u.farm.surfacePerTile=u.farm.totalSurface/e}if(u.farm.parcels.length>0)for(var g=0;g<u.farm.parcels.length;g++){var h=u.farm.parcels[g];h.surface=Math.ceil(h.surface*u.farm.surfacePerTile*100)/100;var m=cc.instantiate(this.parcelButtonPrefab),v=m.getComponent(s);v.parcel=h,m.setParent(this.mapUILayer),m.setPosition(this.tileToUI(h.rect.center))}else cc.error("No parcels found! Please check you filled the mapParcel and parcelGID arrays")},addDebugInfo:function(){if(this.mapObjects)for(var e=0;e<this.mapObjects.length;e++)for(var t=this.mapObjects[e].getObjectGroups(),n=t.length-1;n>=0;n--)for(var i=t[n],a=i.getObjects(),s=0;s<a.length;s++){var r=a[s],o=cc.v2(r.sgNode.x,r.sgNode.y),c=cc.instantiate(this.debugLabelPrefab);c.setParent(this.mapUILayer),c.setPosition(this.mapToUI(o));var l=c.getComponentInChildren(cc.Label);l.string=r.name+": "+Math.floor(r.sgNode.x)+","+Math.floor(r.sgNode.y)}},__Debug:function(){}});t.exports=p,cc._RF.pop()},{"./Farm":"Farm","./Game":"Game","./GamePhase":"GamePhase","./Parcel":"Parcel","./UI/UIDebug":"UIDebug","./UI/UIEnv":"UIEnv","./UI/UIOffice":"UIOffice","./UI/UIParcelButton":"UIParcelButton",LanguageData:"LanguageData"}],Parcel:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"65708Jw+k5C1oyCvtOGSAar","Parcel"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=cc.Enum({EMPTY:0,FALLOW:1,PLOWED:2,SEEDS:4,GROWING:5,READY:6}),r=function(){function e(t,n,a){i(this,e),this.uid=t,void 0===n?this.name="":this.name=n,this.tiledLayer=a,this.tiles=[],this.rect=cc.rect(),this.state=s.EMPTY,this.surface=0,this.rotationHistory=[],this.rotationPrevision=[],this.solution=null}return a(e,[{key:"hasTile",value:function(e){for(var t=0;t<this.tiles.length;t++)if(this.tiles[t].x===e.x&&this.tiles[t].y===e.y)return!0;return!1}},{key:"isAdjacent",value:function(e){for(var t=0;t<this.tiles.length;t++){var n=this.tiles[t];if(1==Math.abs(n.x-e.x)&&0==Math.abs(n.y-e.y))return!0;if(1==Math.abs(n.y-e.y)&&0==Math.abs(n.x-e.x))return!0}return!1}},{key:"addTile",value:function(e){this.tiles.push(e),0==this.rect.width&&(this.rect.x=e.x,this.rect.y=e.y,this.rect.width=1,this.rect.height=1),this.rect.x>e.x&&(this.rect.x=e.x),this.rect.xMax<e.x&&(this.rect.width=e.x-this.rect.x),this.rect.y>e.y&&(this.rect.y=e.y),this.rect.yMax<e.y&&(this.rect.height=e.y-this.rect.y),this.surface++}}]),e}();n["default"]=r,t.exports=n["default"],cc._RF.pop()},{}],Plant:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"5c449arTcdBdrBCkvQ3zcI7","Plant"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("../../../common/constants"),r=function(){function e(t){i(this,e),this._valid=!0,this.dbId={},this.buyPrices={},this.sellPrices={},this.tiledGID=[],void 0!==t&&(this.species=t.species,this.updatePrices(t)),void 0===this.species&&(this.valid=!1,cc.error("Invalid plant JSon: "+t))}return a(e,[{key:"updatePrices",value:function(e){if(void 0!==e.cultureMode&&void 0!==e.pricePerHectare){var t=this._CultureMode(e.cultureMode);this.dbId[t]&&this.dbId[t]!=e._id&&cc.warn("Conflict on plant: "+this.species+" / mode: "+t),this.dbId[t]=e._id,this.buyPrices[t]=e.pricePerHectare,this.sellPrices[t]=10*e.pricePerHectare}}},{key:"_CultureMode",value:function(e){var t=e;return t!=s.CultureModeEnum.NORMAL&&t!=s.CultureModeEnum.BIO&&t!=s.CultureModeEnum.PERMACULTURE&&(cc.error("Invalid culture mode: "+e),t=s.CultureModeEnum.NORMAL),t}},{key:"getBuyPrice",value:function(e){return this.buyPrices[this._CultureMode(e)]}},{key:"getSellPrice",value:function(e){return this.sellPrices[this._CultureMode(e)]}},{key:"isFallow",get:function(){return"fallow"===this.species||"pasture"===this.species}}]),e}();n["default"]=r,t.exports=n["default"],cc._RF.pop()},{"../../../common/constants":1}],RscPreload:[function(e,t,n){"use strict";cc._RF.push(t,"65250CXe7xM6InnrNr1oCQh","RscPreload");var i=cc.Class({"extends":cc.Component,editor:{menu:"gof/RscPreload"},properties:{plantIconsAtlas:{"default":null,type:cc.SpriteAtlas},plantDisIconsAtlas:{"default":null,type:cc.SpriteAtlas},noteIconsAtlas:{"default":null,type:cc.SpriteAtlas}},statics:{instance:null,_plantIconId:{corn:"mais",wheat:"ble",durum_wheat:"ble",soft_wheat:"ble",carrot:"carotte",sunflower:"tournesol",barley:"orge",oat:"avoine",rye:"seigle",buckwheat:"sarrasin",pea:"pois",beetroot:"betterave",field_bean:"feverole",soy:"soja",pasture:"prairies",fallow:"prairies"},getPlantIcon:function(e,t){if(null===i.instance)return cc.error("RscPreload not loaded"),null;var n=i._plantIconId[e];return void 0===n&&(n=e),t?i.instance.plantDisIconsAtlas.getSpriteFrame("ico_"+n):i.instance.plantIconsAtlas.getSpriteFrame("ico_"+n)}},onLoad:function(){null!=i.instance&&cc.error("An instance of RscPreload already exists"),i.instance=this}});t.exports=i,cc._RF.pop()},{}],SpriteFrameSet:[function(e,t,n){"use strict";cc._RF.push(t,"97019Q80jpE2Yfz4zbuCZBq","SpriteFrameSet");var i=cc.Class({name:"SpriteFrameSet",properties:{language:"",spriteFrame:cc.SpriteFrame}});t.exports=i,cc._RF.pop()},{}],Startup:[function(e,t,n){"use strict";cc._RF.push(t,"ae2f9bQf21IhJYFeGxAPR6E","Startup");var i=e("LanguageData"),a=e("./ApiClient"),s=e("./Game"),r=new s,o=e("./UI/UIDebug"),c=e("./UI/UIEnv");cc.Class({"extends":cc.Component,editor:{menu:"gof/Startup"},properties:{},onLoad:function(){var e="/api",t="localhost"==location.hostname&&3e3!=location.port;t&&(e="http://gof.shinypix.dev:3000/api"),o.log("API endpoint: "+e);var n=this,s=new a(e);s.checkAuth(function(e,a,r){if(e){if(!t)return c.message.show(i.t("error_auth_missing"),i.t("error"),{onOk:function(){location.pathname="/auth/login"}}),void o.log("Error: you are not logged in!");var l=prompt("email"),u=prompt("password");r.login(l,u,function(e,t,a){e?(c.message.show(i.t("error_connection_failed"),"Login failed!",{onOk:function(){location.reload()}}),o.log("Error: Login failed!"),cc.error("Login failed")):(localStorage.setItem("gof-access-token",t.payload.accessToken),n.whenLoggedIn(s))})}else n.whenLoggedIn(s)})},start:function(){null!=o.instance&&(o.instance.node.active=r.isDebug);var e=new cc.ResolutionPolicy(cc.ContainerStrategy.PROPORTION_TO_FRAME,cc.ContentStrategy.EXACT_FIT);cc.view.setDesignResolutionSize(1280,720,e),cc.view.resizeWithBrowserSize(!0)},whenLoggedIn:function(e){r.api=e,r.pullDatabase()}}),cc._RF.pop()},{"./ApiClient":"ApiClient","./Game":"Game","./UI/UIDebug":"UIDebug","./UI/UIEnv":"UIEnv",LanguageData:"LanguageData"}],UICheat:[function(e,t,n){"use strict";cc._RF.push(t,"ee4e2PdBRtJFKhTZAymanIB","UICheat");var i=e("../Game"),a=(e("./UIDebug"),e("../../../../common/constants")),s=new i;cc.Class({"extends":cc.Component,properties:{bgPopup:{"default":null,type:cc.Node}},onLoad:function(){this.bgPopup.active=!1,s.isDebug&&cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},onDestroy:function(){s.isDebug&&cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},onKeyDown:function(e){switch(e.keyCode){case cc.KEY.c:this.bgPopup.active^=!0;break;case cc.KEY.escape:this.onBtClose()}},onBtRandomRotation:function(){if(s.farm.parcels.length>0)for(var e=0;e<s.farm.parcels.length;e++){var t=s.farm.parcels[e];if(0===t.rotationPrevision.length){var n=Math.floor(cc.random0To1()*s.plants.length);n==s.plants.length&&n--;var i=s.plants[n],r=a.CultureModeEnum.NORMAL;n=Math.floor(3*cc.random0To1()),1==n&&(r=a.CultureModeEnum.BIO),2==n&&(r=a.CultureModeEnum.PERMACULTURE),t.rotationPrevision.push({species:i.species,culture:r})}}this.onBtClose()},onBtClearRotation:function(){if(s.farm.parcels.length>0)for(var e=0;e<s.farm.parcels.length;e++){var t=s.farm.parcels[e];t.rotationPrevision.length>0&&(t.rotationPrevision=[])}this.onBtClose()},onBtClose:function(){this.bgPopup.active=!1}}),cc._RF.pop()},{"../../../../common/constants":1,"../Game":"Game","./UIDebug":"UIDebug"}],UIDebug:[function(e,t,n){"use strict";cc._RF.push(t,"18ea2AjTFtAb7SJWmEwfDmn","UIDebug");var i=cc.Class({"extends":cc.Component,editor:{menu:"gof/UIDebug"},properties:{debugLabel:{"default":null,type:cc.Label},touchLabel:{"default":null,type:cc.Label},mapScrollView:{"default":null,type:cc.ScrollView}},statics:{instance:null,_log:[],log:function(e){i._log.unshift(e),i._log.length>5&&i._log.pop()},touchLog:""},onLoad:function(){null!=i.instance&&cc.error("UIDebug instance already loaded"),i.instance=this,this.debugLabel.string="",this.touchLabel.string=""},start:function(e){},update:function(e){if(null!=this.debugLabel){this.debugLabel.string="";for(var t=0;t<i._log.length;t++)this.debugLabel.string+=i._log[t]+"\n"}null!=this.touchLabel&&(this.touchLabel.string=i.touchLog,null!=this.mapScrollView&&(this.touchLabel.string+=" scrollOffset="+this.mapScrollView.getScrollOffset(),this.touchLabel.string+=" zoom="+this.mapScrollView.content.scaleX))}});t.exports=i,cc._RF.pop()},{}],UIEnv:[function(e,t,n){"use strict";cc._RF.push(t,"6d70dhzfZNFH7Qp5lDKoDB3","UIEnv");var i={message:null,office:null,parcel:null,speciesSelect:null,questInfo:null,questMenu:null,score:null,score_croprotation:null,questIntro:null};t.exports=i,cc._RF.pop()},{}],UIMessage:[function(e,t,n){"use strict";cc._RF.push(t,"d4cf2XJ/iVOPJMeqHGyaeP+","UIMessage");var i=e("./UIPopupBase"),a=e("./UIEnv"),s=e("LanguageData"),r=cc.Class({"extends":i,editor:{menu:"gof/UIMessage"},properties:{bgLock:{"default":null,type:cc.Node},lbTitle:{"default":null,type:cc.Label},lbMessage:{"default":null,type:cc.Label},btOk:{"default":null,type:cc.Button},_lbOk:{"default":null,type:cc.Label,visible:!1},btYes:{"default":null,type:cc.Button},_lbYes:{"default":null,type:cc.Label,visible:!1},btNo:{"default":null,type:cc.Button},_lbNo:{"default":null,type:cc.Label,visible:!1}},statics:{YES_NO:{buttons:"yes_no"},OK_CANCEL:{buttons:"ok_cancel"}},_messagesOptions:null,onLoad:function(){a.message=this,this.initPopup(),this._lbOk=this.btOk.node.getComponentInChildren(cc.Label),this._lbYes=this.btYes.node.getComponentInChildren(cc.Label),this._lbNo=this.btNo.node.getComponentInChildren(cc.Label),this._lbOk.string=s.t("ok").toUpperCase()},show:function(e,t,n){void 0!==t&&null!==t&&""!=t||(t=s.t("message").toUpperCase()),this.lbMessage.string=e,this.lbTitle.string=t,void 0!=n?this._messagesOptions=n:this._messagesOptions=null,this.bgLock.active=!0,null!=this._messagesOptions?(this.btOk.node.active=void 0==this._messagesOptions.buttons||"ok"==this._messagesOptions.buttons,this.btYes.node.active="yes_no"==this._messagesOptions.buttons||"ok_cancel"==this._messagesOptions.buttons,this.btNo.node.active=this.btYes.node.active,this._lbYes.string="yes_no"==this._messagesOptions.buttons?s.t("yes").toUpperCase():s.t("ok").toUpperCase(),this._lbNo.string="yes_no"==this._messagesOptions.buttons?s.t("no").toUpperCase():s.t("cancel").toUpperCase()):(this.btOk.node.active=!0,this.btYes.node.active=!1,this.btNo.node.active=!1),this.showPopup()},hide:function(){this.bgLock.active=!1,this.hidePopup()},onBtOk:function(){void 0!==this._messagesOptions.onOk&&this._messagesOptions.onOk(this._messagesOptions.self),this.hide()},onBtYes:function(){void 0!==this._messagesOptions.onOk&&this._messagesOptions.onOk(this._messagesOptions.self),this.hide()},onBtNo:function(){void 0!==this._messagesOptions.onCancel&&this._messagesOptions.onCancel(this._messagesOptions.self),this.hide()}});t.exports=r,cc._RF.pop()},{"./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UIOffice:[function(e,t,n){
"use strict";cc._RF.push(t,"6a190mC+6ZOA5vlgY1st6XK","UIOffice");var i=e("./UIPopupBase"),a=e("../Game"),s=e("./UIEnv"),r=e("LanguageData"),o=cc.Class({"extends":i,editor:{menu:"gof/UIOffice"},properties:{farmName:{"default":null,type:cc.Label},totalSurface:{"default":null,type:cc.Label},nbParcels:{"default":null,type:cc.Label}},statics:{instance:null},onLoad:function(){o.instance=this,s.office=this,this.initPopup()},show:function(){s.parcel.hide(),s.speciesSelect.hide(),this.showPopup()},onShow:function(){var e=new a,t=e.farm.name;void 0===t&&(t=r.t("farm_default_name").toUpperCase()),this.farmName.string=t,this.totalSurface.string=r.t("surface_hectare",{val:e.farm.totalSurface}),this.nbParcels.string=e.farm.parcels.length.toString()},onBtClose:function(){this.hide()}});cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UIParcelButton:[function(e,t,n){"use strict";cc._RF.push(t,"1eeb4QRRqVC67SdkLrVyELP","UIParcelButton");var i=e("../Parcel"),a=e("./UIParcel"),s=e("../RscPreload");cc.Class({"extends":cc.Component,editor:{menu:"gof/UIParcelButton"},properties:{parcelName:{"default":null,type:cc.Label},parcelSpecies:{"default":null,type:cc.Sprite},parcel:{visible:!1,get:function(){return this._parcel},set:function(e){this._parcel=e,null!=this._parcel&&null!=this.parcelName&&(this.parcelName.string=this._parcel.name)},type:i}},_parcel:null,_species:null,onLoad:function(){this.parcelSpecies.node.active=!1},update:function(e){if(null!=this._parcel){var t=null;this._parcel.rotationPrevision.length>0&&(t=this._parcel.rotationPrevision[0].species),t!=this._species&&(null!=t?(this.parcelSpecies.node.active=!0,this.parcelSpecies.spriteFrame=s.getPlantIcon(t)):this.parcelSpecies.node.active=!1,this._species=t)}},onButtonClick:function(){a.instance.parcel=this.parcel,a.instance.show()}}),cc._RF.pop()},{"../Parcel":"Parcel","../RscPreload":"RscPreload","./UIParcel":"UIParcel"}],UIParcelHistoryItem:[function(e,t,n){"use strict";cc._RF.push(t,"e26d4zHk5xHfoZ0d5p3J3O6","UIParcelHistoryItem");var i=e("../Parcel"),a=(e("../Plant"),e("../RscPreload")),s=e("./UIEnv"),r=e("LanguageData"),o=cc.Class({"extends":cc.Component,editor:{menu:"gof/UIParcelHistoryItem"},properties:{iconSpecies:{"default":null,type:cc.Sprite},lbSpecies:{"default":null,type:cc.Label},lbCulture:{"default":null,type:cc.Label},lbYear:{"default":null,type:cc.Label},btAdd:{"default":null,type:cc.Button},btEdit:{"default":null,type:cc.Button},parcel:{"default":null,visible:!1,type:i},year:{"default":0,visible:!1}},onLoad:function(){},initCulture:function(e,t,n,i){this.parcel=e,this.year=t;var s;s=t<0?t.toString():"+"+t.toString(),this.lbYear.string=r.t("parcel_history_year",{val:s}),void 0===n||null===n?(this.lbSpecies.string=r.t("new").toUpperCase(),this.lbCulture.string="",this.iconSpecies.node.active=!1,this.btAdd.node.active=!0,this.btEdit.node.active=!1):"fallow"===n.species||"pasture"===n.species?(this.lbSpecies.string=r.t("fallow").toUpperCase(),this.lbCulture.string="",this.iconSpecies.node.active=!0,this.iconSpecies.spriteFrame=a.getPlantIcon("fallow"),this.btAdd.node.active=!1,this.btEdit.node.active=i):(this.lbSpecies.string=r.t("plant_"+n.species).toUpperCase(),void 0!==n.culture?this.lbCulture.string=r.t("culture_"+n.culture).toUpperCase():this.lbCulture.string=r.t("culture_normal").toUpperCase(),this.iconSpecies.node.active=!0,this.iconSpecies.spriteFrame=a.getPlantIcon(n.species),this.btAdd.node.active=!1,this.btEdit.node.active=i)},onBtAdd:function(){s.speciesSelect.show(this.parcel,this.year)}});t.exports=o,cc._RF.pop()},{"../Parcel":"Parcel","../Plant":"Plant","../RscPreload":"RscPreload","./UIEnv":"UIEnv",LanguageData:"LanguageData"}],UIParcel:[function(e,t,n){"use strict";cc._RF.push(t,"5ed45J19xFADpo251R2d6oz","UIParcel");var i=e("./UIPopupBase"),a=e("../Parcel"),s=e("./UIParcelHistoryItem"),r=e("../Game"),o=e("./UIEnv"),c=e("LanguageData"),l=new r,u=cc.Class({"extends":i,editor:{menu:"gof/UIParcel"},properties:{parcelName:{"default":null,type:cc.Label},parcelGroundType:{"default":null,type:cc.Label},parcelSurface:{"default":null,type:cc.Label},historyScrollView:{"default":null,type:cc.ScrollView},previsionScrollView:{"default":null,type:cc.ScrollView},plantPrefab:{"default":null,type:cc.Prefab},parcel:{visible:!1,get:function(){return this._parcel},set:function(e){this._parcel=e,null!=this._parcel&&null!=this.parcelName,this._hidden||this.onShow()},type:a}},statics:{instance:null},_parcel:null,onLoad:function(){u.instance=this,this.initPopup(),o.parcel=this},show:function(){o.office.hide(),this.showPopup()},onShow:function(){var e=this.historyScrollView.content;e.removeAllChildren(!0);var t=this.previsionScrollView.content;if(t.removeAllChildren(!0),null!=this._parcel){this.parcelName.string=this._parcel.name,this.parcelGroundType.string=c.t("terrain_type_clay").toUpperCase(),this.parcelSurface.string=c.t("surface_hectare",{val:this._parcel.surface.toString()});for(var n=this._parcel.rotationHistory.length-1;n>=0;n--){var i=cc.instantiate(this.plantPrefab);i.setParent(e);var a=i.getComponent(s);a.initCulture(this._parcel,-(n+1),this._parcel.rotationHistory[n],!1)}this.updateRotationPrevisions(),this.historyScrollView.scrollToRight(),this.previsionScrollView.scrollToLeft()}},updateRotationPrevisions:function(){var e=this.previsionScrollView.content;e.removeAllChildren(!0);for(var t=0;t<this._parcel.rotationPrevision.length;t++){var n=cc.instantiate(this.plantPrefab);n.setParent(e);var i=n.getComponent(s);i.initCulture(this._parcel,t,this._parcel.rotationPrevision[t],!0)}this.addEmptyPrevision()},addEmptyPrevision:function(){if(null!=l.phase&&this._parcel.rotationPrevision.length<l.phase.maxPrevisions){var e=cc.instantiate(this.plantPrefab);e.setParent(this.previsionScrollView.content);var t=e.getComponent(s);t.initCulture(this._parcel,this._parcel.rotationPrevision.length)}},onBtClose:function(){this.hide()}});t.exports=u,cc._RF.pop()},{"../Game":"Game","../Parcel":"Parcel","./UIEnv":"UIEnv","./UIParcelHistoryItem":"UIParcelHistoryItem","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UIPopupBase:[function(e,t,n){"use strict";cc._RF.push(t,"26b02/CIaZOIqLKQKleyE5X","UIPopupBase");var i=cc.Enum({LEFT:0,RIGHT:1,TOP:2,BOTTOM:3,NONE:4});cc.Class({"extends":cc.Component,properties:{Popup:{"default":null,type:cc.Node},From:{"default":i.LEFT,type:i},isShown:{visible:!1,get:function(){return!this._hidden}}},_hidden:!1,initPopup:function(){null==this.Popup&&(this.Popup=this.node),this._hidden=!1,this._defaultX=this.Popup.x,this._defaultY=this.Popup.y,this._size=this.Popup.getContentSize(),this.hide(!0)},showPopup:function(){this._hidden&&(this.Popup.stopAllActions(),this.Popup.active||(this.Popup.active=!0),this.From!=i.NONE&&this.Popup.runAction(cc.moveTo(.2,cc.p(this._defaultX,this._defaultY))),this._hidden=!1,void 0!==this.onShow&&this.onShow())},hidePopup:function(e){if(!this._hidden){if(this.Popup.stopAllActions(),this.From!=i.NONE){var t=cc.Canvas.instance.node.width,n=cc.Canvas.instance.node.height,a=new cc.Vec2(this._defaultX,this._defaultY);switch(this.From){case i.LEFT:a.x=-t;break;case i.RIGHT:a.x=t;break;case i.TOP:a.y=n;break;case i.BOTTOM:a.y=-n;break;default:cc.error("Invalid from value: "+this.From),a.x=-t}e?(this.Popup.x=a.x,this.Popup.y=a.y):this.Popup.runAction(cc.moveTo(.2,a))}else this.Popup.active=!1;this._hidden=!0,void 0!==this.onHide&&this.onHide()}},show:function(){this.showPopup()},hide:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.hidePopup(e)}});cc._RF.pop()},{}],UIQuestInfo:[function(e,t,n){"use strict";cc._RF.push(t,"fe209aGUCRMrqhIU/Rt+APS","UIQuestInfo");var i=e("./UIPopupBase"),a=e("./UIEnv"),s=e("../Game"),r=new s,o=cc.Class({"extends":i,editor:{menu:"gof/UIQuestInfo"},properties:{lbDescription:{"default":null,type:cc.Label},lbCompletion:{"default":null,type:cc.Label},btValidate:{"default":null,type:cc.Button}},statics:{instance:null},onLoad:function(){o.instance=this,a.questInfo=this,this.initPopup()},onShow:function(){null!=r.phase&&(this.lbDescription.string=r.phaseGetObjectiveText(),this.lbCompletion.string=r.phaseGetCompletionStr(),this.btValidate.interactable=r.phaseCanFinish())},onBtValidate:function(){if(r.phaseCanFinish()){for(var e=0,t=r.phase.perfectScore/r.farm.parcels.length,n=[],i=0;i<r.farm.parcels.length;++i){var s=r.farm.parcels[i],o=s.solution,c=s.rotationPrevision[0],l={parcelName:s.name,note:4};o.perfects.indexOf(c.species)>-1?(l.note=1,e+=t):o.acceptables.indexOf(c.species)>-1?(l.note=2,e+=.8*t):o.bads.indexOf(c.species)>-1&&(l.note=3,e-=.4*t),n.push(l)}e=Math.round(e);var u=e/r.phase.perfectScore;u>1&&(u=1),a.score_croprotation.setResults(n),a.score_croprotation.setScoreText(Math.round(20*u)+" / 20"),a.score_croprotation.show()}},onBtClose:function(){this.hide()}});t.exports=o,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase"}],UIQuestIntro:[function(e,t,n){"use strict";cc._RF.push(t,"a2ec7ttv5JG+pgS8fICxmUc","UIQuestIntro");var i=(e("./UIPopupBase"),e("./UIEnv")),a=e("../Game"),s=new a,r=cc.Class({"extends":cc.Component,editor:{menu:"gof/UIQuestIntro"},properties:{bgLock:{"default":null,type:cc.Node},popup:{"default":null,type:cc.Node},lbDescription:{"default":null,type:cc.Label},_hidden:{"default":!0,visible:!1}},onLoad:function(){i.questIntro=this,this.bgLock.active=!1,this._from=this.From,this._hidden=!0,this._defaultX=this.popup.x,this._defaultY=this.popup.y,this.popup.active=!1},show:function(){null!=s.phase&&(this.lbDescription.string=s.phaseGetIntroText()),this.bgLock.active=!0,this.popup.active=!0,this.popup.x=this._defaultX,this.popup.y=this._defaultY,this._hidden=!1},hide:function(){this.bgLock.active=!1,this.hidePopup()},hidePopup:function(e){if(!this._hidden){this.popup.stopAllActions();var t=(cc.Canvas.instance.node.width,cc.Canvas.instance.node.height),n=new cc.Vec2(this._defaultX,this._defaultY);n.y=t,e?(this.popup.x=n.x,this.popup.y=n.y):this.popup.runAction(cc.moveTo(.2,n)),this._hidden=!0}},onBtStart:function(){s.phaseStart(),this.hide()}});t.exports=r,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase"}],UIQuestMenu:[function(e,t,n){"use strict";cc._RF.push(t,"7d7c3/wn7ZCuLYYti4yjtS7","UIQuestMenu");var i=e("../Game"),a=e("./UIEnv"),s=new i,r=cc.Class({"extends":cc.Component,editor:{menu:"gof/UIQuestMenu"},properties:{btOpen:{"default":null,type:cc.Button},highlight:{"default":null,type:cc.Node},_hlAnim:{"default":null,type:cc.Animation,visible:!1},fxParticles:{"default":null,type:cc.ParticleSystem},_isAnimated:{"default":!1,visible:!1}},onLoad:function(){a.questMenu=this,this._hlAnim=this.highlight.getComponent(cc.Animation),this.highlight.active=!1,this.fxParticles.stopSystem(),this._isAnimated=!1,this.btOpen.interactable=!1},update:function(e){if(!(s.state<i.State.PHASE_RUN)){this.btOpen.interactable=s.state<i.State.PHASE_SCORE&&null!=a.questInfo&&!a.questInfo.isShown;var t=this.btOpen.interactable&&s.phaseCanFinish();t!=this._isAnimated&&(t?(this.highlight.active=!0,this._hlAnim.play(),this.fxParticles.resetSystem()):(this._hlAnim.stop(),this.fxParticles.stopSystem(),this.highlight.active=!1),this._isAnimated=t)}},onBtOpen:function(){a.questInfo.show()}});t.exports=r,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv"}],UIScore_croprotation:[function(e,t,n){"use strict";cc._RF.push(t,"b6098hR08JLhqWX764cWMcE","UIScore_croprotation");var i=e("./UIPopupBase"),a=e("../Game"),s=e("RscPreload"),r=e("./UIEnv"),o=(e("LanguageData"),new a,cc.Class({"extends":i,editor:{menu:"gof/UIScore_croprotation"},properties:{scoreText:{"default":null,type:cc.Label},itemPrefab:{"default":null,type:cc.Prefab},scrollView:{"default":null,type:cc.ScrollView}},statics:{instance:null},onLoad:function(){o.instance=this,r.score_croprotation=this,this.initPopup()},show:function(){r.parcel.hide(),r.speciesSelect.hide(),r.questInfo.hide(),this.showPopup()},onShow:function(){},setResults:function(e){var t=this.scrollView.content;t.removeAllChildren(!0);for(var n=0;n<e.length;n++){var i=cc.instantiate(this.itemPrefab),a=e[n],r=i.getChildByName("ParcelleName").getComponent(cc.Label);r&&(r.string=a.parcelName);var o=i.getChildByName("icon_note").getComponent(cc.Sprite);o&&(o.spriteFrame=s.instance.noteIconsAtlas.getSpriteFrame("note"+a.note)),i.setParent(t)}},setScoreText:function(e){this.scoreText.string=e},update:function(e){},onBtNext:function(){this.hide()}}));cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData",RscPreload:"RscPreload"}],UIScore:[function(e,t,n){"use strict";cc._RF.push(t,"3ac5eIDVhJJ/ofpayCfR0NL","UIScore");var i=e("./UIPopupBase"),a=e("../Game"),s=e("./UIEnv"),r=(e("LanguageData"),new a,cc.Class({"extends":i,editor:{menu:"gof/UIScore"},properties:{drawingZone:{"default":null,type:cc.Node},scoreText:{"default":null,type:cc.Label}},statics:{instance:null},onLoad:function(){r.instance=this,s.score=this,this.initPopup(),this.spider=this.drawingZone.addComponent(cc.Graphics)},show:function(){s.parcel.hide(),s.speciesSelect.hide(),s.questInfo.hide(),this.showPopup()},onShow:function(){},setScore:function(e,t,n,i,a,s){this.scoreText.string=s;for(var r=this.spider,o=new cc.Vec2((-151),(-66)),c=[new cc.Vec2(0,1),new cc.Vec2(150,42),new cc.Vec2(84,(-124)),new cc.Vec2((-84),(-124)),new cc.Vec2((-150),42)],l=0;l<c.length;++l)c[l]=c[l].normalize();var u=[e,t,n,i,a];r.clear(),r.fillColor=new cc.Color(167,247,192,160),r.strokeColor=new cc.Color(142,162,105,160),r.lineWidth=6;for(var p=null,l=0;l<c.length;++l){var h=c[l],d=h.mul(160*u[l]),f=o.add(d);l?r.lineTo(f.x,f.y):(r.moveTo(f.x,f.y),p=f)}r.lineTo(p.x,p.y),r.stroke(),r.fill(),this.drawingZone.opacity=127},update:function(e){},onBtNext:function(){this.hide()}}));cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase",LanguageData:"LanguageData"}],UISpeciesSelItem:[function(e,t,n){"use strict";cc._RF.push(t,"aaef9bEqX5BcJFGX/hbg8UC","UISpeciesSelItem");var i=e("LanguageData"),a=(e("Plant"),e("RscPreload")),s=e("../../../../common/constants"),r=cc.Class({"extends":cc.Component,editor:{menu:"gof/UISpeciesSelItem"},properties:{speciesName:{"default":null,type:cc.Label},speciesVariety:{"default":null,type:cc.Label},speciesIcon:{"default":null,type:cc.Sprite},buyPriceNormal:{"default":null,type:cc.Label},sellPriceNormal:{"default":null,type:cc.Label},btNormal:{"default":null,type:cc.Button},buyPriceBio:{"default":null,type:cc.Label},sellPriceBio:{"default":null,type:cc.Label},btBio:{"default":null,type:cc.Button},buyPricePerma:{"default":null,type:cc.Label},sellPricePerma:{"default":null,type:cc.Label},btPerma:{"default":null,type:cc.Button},btAdd:{"default":null,type:cc.Button},hlSelected:{"default":null,type:cc.Node},isSelected:{visible:!1,get:function(){return this._isSelected},set:function(e){this._isSelected!==e&&(this._isSelected=e,e&&null!==this.selectionCallback&&this.selectionCallback(this),this._selectionChanged=!0)}},plant:{visible:!1,get:function(){return this._plant},set:function(e){this._plant=e,this._plantChanged=!0}},cultureMode:{visible:!1,get:function(){return this._cultureMode},set:function(e){this._cultureMode=e,this._cultureChanged=!0}},_cultureMode:{"default":s.CultureModeEnum.NORMAL,visible:!1},selectionCallback:{visible:!1,"default":null,type:Object},validationCallback:{visible:!1,"default":null,type:Object}},_plant:null,_plantChanged:!1,_cultureChanged:!1,_isSelected:!1,_selectionChanged:!1,onLoad:function(){this.speciesVariety.string="",this.hlSelected.active=!1},updateUI:function(){null!=this._plant&&(this._plantChanged&&(this._plant.isFallow?(this.speciesName.string=i.t("fallow").toUpperCase(),this.speciesIcon.spriteFrame=a.instance.plantIconsAtlas.getSpriteFrame("ico_prairies")):(this.speciesName.string=i.t("plant_"+this._plant.species).toUpperCase(),this.speciesIcon.spriteFrame=a.getPlantIcon(this._plant.species)),this._plantChanged=!1,this._selectionChanged=!0,this._cultureChanged=!0),this._cultureChanged&&(this._plant.isFallow?(this.buyPriceNormal.string="",this.buyPriceBio.string="",this.buyPricePerma.string="",this.sellPriceNormal.string="",this.sellPriceBio.string="",this.sellPricePerma.string="",this.btNormal.node.active=!1,this.btBio.node.active=!1,this.btPerma.node.active=!1):(this.buyPriceNormal.string=this._plant.getBuyPrice(s.CultureModeEnum.NORMAL).toString(),this.buyPriceBio.string=this._plant.getBuyPrice(s.CultureModeEnum.BIO).toString(),this.buyPricePerma.string=this._plant.getBuyPrice(s.CultureModeEnum.PERMACULTURE).toString(),this.sellPriceNormal.string=this._plant.getSellPrice(s.CultureModeEnum.NORMAL).toString(),this.sellPriceBio.string=this._plant.getSellPrice(s.CultureModeEnum.BIO).toString(),this.sellPricePerma.string=this._plant.getSellPrice(s.CultureModeEnum.PERMACULTURE).toString(),this.btNormal.interactable=this.cultureMode!=s.CultureModeEnum.NORMAL,this.btBio.interactable=this.cultureMode!=s.CultureModeEnum.BIO,this.btPerma.interactable=this.cultureMode!=s.CultureModeEnum.PERMACULTURE)),this._selectionChanged&&(this.hlSelected.active=this._isSelected))},update:function(e){this.updateUI()},onBtCultureNormal:function(){null==this._plant||this._plant.isFallow||(this.cultureMode=s.CultureModeEnum.NORMAL)},onBtCultureBio:function(){null==this._plant||this._plant.isFallow||(this.cultureMode=s.CultureModeEnum.BIO)},onBtCulturePerma:function(){null==this._plant||this._plant.isFallow||(this.cultureMode=s.CultureModeEnum.PERMACULTURE)},onBtAdd:function(){null!=this._plant&&null!=this.validationCallback&&this.validationCallback({species:this._plant.species,culture:this._cultureMode})}});t.exports=r,cc._RF.pop()},{"../../../../common/constants":1,LanguageData:"LanguageData",Plant:"Plant",RscPreload:"RscPreload"}],UISpeciesSelPopup:[function(e,t,n){"use strict";cc._RF.push(t,"be3ddDBLZpLTbjtJ2jb+FZn","UISpeciesSelPopup");var i=e("./UIPopupBase"),a=e("../Game"),s=(e("./UISpeciesSelItem"),e("./UIEnv")),r=cc.Class({"extends":i,editor:{menu:"gof/UISpeciesSelPopup"},properties:{itemPrefab:{"default":null,type:cc.Prefab},scrollView:{"default":null,type:cc.ScrollView},_parcel:{"default":null,visible:!1},_previsionYear:{"default":-1,visible:!1}},statics:{instance:null},onLoad:function(){null!=r.instance&&cc.error("An instance of UISpeciesSelPopup already exists"),r.instance=this,s.speciesSelect=this,this.initPopup()},show:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this._parcel=e,this._previsionYear=t,this.showPopup()},onShow:function(){var e=new a,t=null;this._previsionYear>=0&&this._previsionYear<this._parcel.rotationPrevision.length&&(t=this._parcel.rotationPrevision[this._previsionYear]);var n=this.scrollView.content;n.removeAllChildren(!0);for(var i=0;i<e.plants.length;i++)if(!(e.farm.plantExcludes.indexOf(e.plants[i].species)>-1)){var s=cc.instantiate(this.itemPrefab);s.setParent(n);var r=s.getComponent("UISpeciesSelItem");r.plant=e.plants[i],r.selectionCallback=this.onItemSelection,r.validationCallback=this.onItemValidation,null!==t&&t.species==r.plant.species&&(t.culture&&(r.cultureMode=t.culture),r.isSelected=!0)}},onHide:function(){},onItemSelection:function(e){for(var t=r.instance.scrollView.content.children,n=0;n<t.length;n++){var i=t[n].getComponent("UISpeciesSelItem");i.isSelected&&e.plant!==i.plant&&(i.isSelected=!1)}},onItemValidation:function(e){var t=r.instance;t._previsionYear>=0&&t._previsionYear<t._parcel.rotationPrevision.length?t._parcel.rotationPrevision[t._previsionYear]=e:t._parcel.rotationPrevision.push(e),s.parcel.updateRotationPrevisions(),t.hide()},onBtClose:function(){this.hide()}});t.exports=r,cc._RF.pop()},{"../Game":"Game","./UIEnv":"UIEnv","./UIPopupBase":"UIPopupBase","./UISpeciesSelItem":"UISpeciesSelItem"}],UITop:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}cc._RF.push(t,"5d170x4gqNGn6wYSkUsy2s+","UITop");var a=e("Game"),s=i(a),r=e("Farm"),o=(i(r),new s["default"]),c=e("LanguageData");cc.Class({"extends":cc.Component,editor:{menu:"gof/UITop"},properties:{dateLabel:{"default":null,type:cc.RichText},moneyLabel:{"default":null,type:cc.Label}},onLoad:function(){this.moneyLabel.string="",this.dateLabel.string=""},start:function(){},update:function(e){if(null!=o.phase){var t=o.farm;this.moneyLabel.string=o.farm.money;var n=c.t("month_"+(t.month+1));this.dateLabel.string=c.t("date_value",{year:t.year,month:n,week:t.week+1})}}}),cc._RF.pop()},{Farm:"Farm",Game:"Game",LanguageData:"LanguageData"}],"polyglot.min":[function(e,t,n){"use strict";cc._RF.push(t,"e26fd9yy65A4q3/JkpVnFYg","polyglot.min");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,a){"function"==typeof define&&define.amd?define([],function(){return a(e)}):"object"==("undefined"==typeof n?"undefined":i(n))?t.exports=a(e):e.Polyglot=a(e)}(void 0,function(e){function t(e){e=e||{},this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en",this.allowMissing=!!e.allowMissing,this.warn=e.warn||l}function n(e){var t,n,i,a={};for(t in e)if(e.hasOwnProperty(t)){n=e[t];for(i in n)a[n[i]]=t}return a}function a(e){var t=/^\s+|\s+$/g;return e.replace(t,"")}function s(e,t,n){var i,s,r;return null!=n&&e?(s=e.split(p),r=s[o(t,n)]||s[0],i=a(r)):i=e,i}function r(e){var t=n(d);return t[e]||t.en}function o(e,t){return h[r(e)](t)}function c(e,t){for(var n in t)"_"!==n&&t.hasOwnProperty(n)&&(e=e.replace(new RegExp("%\\{"+n+"\\}","g"),t[n]));return e}function l(t){e.console&&e.console.warn&&e.console.warn("WARNING: "+t)}function u(e){var t={};for(var n in e)t[n]=e[n];return t}t.VERSION="0.4.3",t.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},t.prototype.extend=function(e,t){var n;for(var a in e)e.hasOwnProperty(a)&&(n=e[a],t&&(a=t+"."+a),"object"==("undefined"==typeof n?"undefined":i(n))?this.extend(n,a):this.phrases[a]=n)},t.prototype.clear=function(){this.phrases={}},t.prototype.replace=function(e){this.clear(),this.extend(e)},t.prototype.t=function(e,t){var n,i;return t=null==t?{}:t,"number"==typeof t&&(t={smart_count:t}),"string"==typeof this.phrases[e]?n=this.phrases[e]:"string"==typeof t._?n=t._:this.allowMissing?n=e:(this.warn('Missing translation for key: "'+e+'"'),i=e),"string"==typeof n&&(t=u(t),i=s(n,this.currentLocale,t.smart_count),i=c(i,t)),i},t.prototype.has=function(e){return e in this.phrases};var p="||||",h={chinese:function(e){return 0},german:function(e){return 1!==e?1:0},french:function(e){return e>1?1:0},russian:function(e){return e%10===1&&e%100!==11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){return 1===e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!==1||e%100===11?1:0}},d={chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru"],czech:["cs"],polish:["pl"],icelandic:["is"]};return t}),cc._RF.pop()},{}]},{},["ApiClient","Farm","Game","GameParcel","GamePhase","MapCtrl","Parcel","Plant","RscPreload","Startup","LocalizedLabelExt","UICheat","UIDebug","UIEnv","UIMessage","UIOffice","UIParcel","UIParcelButton","UIParcelHistoryItem","UIPopupBase","UIQuestInfo","UIQuestIntro","UIQuestMenu","UIScore","UIScore_croprotation","UISpeciesSelItem","UISpeciesSelPopup","UITop","LanguageData","LocalizedLabel","LocalizedSprite","SpriteFrameSet","polyglot.min"]);